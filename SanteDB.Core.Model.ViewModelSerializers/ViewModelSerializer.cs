//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace SanteDB.Core.Model.Json.Formatter {
    using SanteDB.Core.Model;
    
    
    public class AuditDataViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(AuditDataViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Auditing.AuditData);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Auditing.AuditData _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Auditing.AuditData)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Auditing.AuditData)));
            }
            if (context.ShouldSerialize("action")) {
                if ((_strong.ActionCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "action", _strong.ActionCode, context);
                }
            }
            if (context.ShouldSerialize("actor")) {
                if (((_strong.Actors == null) 
                            || (_strong.Actors.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actor", _strong.Actors, context);
                }
            }
            if (context.ShouldSerialize("object")) {
                if (((_strong.AuditableObjects == null) 
                            || (_strong.AuditableObjects.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "object", _strong.AuditableObjects, context);
                }
            }
            if (context.ShouldSerialize("event")) {
                if ((_strong.EventIdentifier == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "event", _strong.EventIdentifier, context);
                }
            }
            if (context.ShouldSerialize("type")) {
                if ((_strong.EventTypeCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "type", _strong.EventTypeCode, context);
                }
            }
            if (context.ShouldSerialize("outcome")) {
                if ((_strong.Outcome == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "outcome", _strong.Outcome, context);
                }
            }
            if (context.ShouldSerialize("timestamp")) {
                if ((_strong.Timestamp == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "timestamp", _strong.Timestamp, context);
                }
            }
            if (context.ShouldSerialize("meta")) {
                if (((_strong.Metadata == null) 
                            || (_strong.Metadata.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "meta", _strong.Metadata, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Auditing.AuditData _retVal = new SanteDB.Core.Auditing.AuditData();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("meta".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Auditing.AuditMetadata>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("meta", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.Metadata = ((System.Collections.Generic.List<SanteDB.Core.Auditing.AuditMetadata>)(_instance));
                            }
                        }
                        else {
                            if ("timestamp".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTime), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("timestamp", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.Timestamp = ((System.DateTime)(_instance));
                                }
                            }
                            else {
                                if ("outcome".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Auditing.OutcomeIndicator), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("outcome", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.Outcome = ((SanteDB.Core.Auditing.OutcomeIndicator)(_instance));
                                    }
                                }
                                else {
                                    if ("type".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Auditing.AuditCode), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("type", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EventTypeCode = ((SanteDB.Core.Auditing.AuditCode)(_instance));
                                        }
                                    }
                                    else {
                                        if ("event".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Auditing.EventIdentifierType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("event", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.EventIdentifier = ((SanteDB.Core.Auditing.EventIdentifierType)(_instance));
                                            }
                                        }
                                        else {
                                            if ("object".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Auditing.AuditableObject>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("object", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.AuditableObjects = ((System.Collections.Generic.List<SanteDB.Core.Auditing.AuditableObject>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("actor".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Auditing.AuditActorData>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actor", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Actors = ((System.Collections.Generic.List<SanteDB.Core.Auditing.AuditActorData>)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("action".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Auditing.ActionType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("action", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ActionCode = ((SanteDB.Core.Auditing.ActionType)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Auditing.AuditData))) {
                                                                SanteDB.Core.Auditing.AuditData _nretVal = ((SanteDB.Core.Auditing.AuditData)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class NonVersionedEntityDataViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(NonVersionedEntityDataViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.NonVersionedEntityData);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.NonVersionedEntityData _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.NonVersionedEntityData)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.NonVersionedEntityData)));
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.NonVersionedEntityData _retVal = new SanteDB.Core.Model.NonVersionedEntityData();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("$type".Equals(r.Value)) {
                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                        if ((_type != typeof(SanteDB.Core.Model.NonVersionedEntityData))) {
                                                                            SanteDB.Core.Model.NonVersionedEntityData _nretVal = ((SanteDB.Core.Model.NonVersionedEntityData)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                            _nretVal.CopyObjectData(_retVal);
                                                                            return _nretVal;
                                                                        }
                                                                    }
                                                                    else {
                                                                        r.Skip();
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SubscriptionDefinitionViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SubscriptionDefinitionViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Subscription.SubscriptionDefinition);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Subscription.SubscriptionDefinition _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Subscription.SubscriptionDefinition)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Subscription.SubscriptionDefinition)));
            }
            if (context.ShouldSerialize("uuid")) {
                if ((_strong.Uuid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "uuid", _strong.Uuid, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("definitions")) {
                if (((_strong.ClientDefinitions == null) 
                            || (_strong.ClientDefinitions.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "definitions", _strong.ClientDefinitions, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Subscription.SubscriptionDefinition _retVal = new SanteDB.Core.Model.Subscription.SubscriptionDefinition();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("definitions".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Subscription.SubscriptionClientDefinition>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("definitions", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ClientDefinitions = ((System.Collections.Generic.List<SanteDB.Core.Model.Subscription.SubscriptionClientDefinition>)(_instance));
                            }
                        }
                        else {
                            if ("uuid".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Guid), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("uuid", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.Uuid = ((System.Guid)(_instance));
                                }
                            }
                            else {
                                if ("$type".Equals(r.Value)) {
                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                    if ((_type != typeof(SanteDB.Core.Model.Subscription.SubscriptionDefinition))) {
                                        SanteDB.Core.Model.Subscription.SubscriptionDefinition _nretVal = ((SanteDB.Core.Model.Subscription.SubscriptionDefinition)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                        _nretVal.CopyObjectData(_retVal);
                                        return _nretVal;
                                    }
                                }
                                else {
                                    r.Skip();
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityApplicationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityApplicationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityApplication);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityApplication _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityApplication)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityApplication)));
            }
            if (context.ShouldSerialize("applicationSecret")) {
                if ((_strong.ApplicationSecret == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "applicationSecret", _strong.ApplicationSecret, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("lockout")) {
                if ((_strong.LockoutXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockout", _strong.LockoutXml, context);
                }
            }
            if (context.ShouldSerialize("lockoutModel")) {
                if ((_strong.Lockout == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockoutModel", _strong.Lockout, context);
                }
            }
            if (context.ShouldSerialize("invalidAuth")) {
                if ((_strong.InvalidAuthAttempts == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "invalidAuth", _strong.InvalidAuthAttempts, context);
                }
            }
            if (context.ShouldSerialize("lastAuthenticationTime")) {
                if ((_strong.LastAuthenticationXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastAuthenticationTime", _strong.LastAuthenticationXml, context);
                }
            }
            if (context.ShouldSerialize("lastAuthenticationTimeModel")) {
                if ((_strong.LastAuthentication == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastAuthenticationTimeModel", _strong.LastAuthentication, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityApplication _retVal = new SanteDB.Core.Model.Security.SecurityApplication();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("lastAuthenticationTimeModel".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastAuthenticationTimeModel", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.LastAuthentication = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("lastAuthenticationTime".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastAuthenticationTime", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.LastAuthenticationXml = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("invalidAuth".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("invalidAuth", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.InvalidAuthAttempts = ((System.Nullable<int>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("lockoutModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockoutModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Lockout = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("lockout".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockout", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.LockoutXml = ((string)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("name".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Name = ((string)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("applicationSecret".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("applicationSecret", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.ApplicationSecret = ((string)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Security.SecurityApplication))) {
                                                                                                        SanteDB.Core.Model.Security.SecurityApplication _nretVal = ((SanteDB.Core.Model.Security.SecurityApplication)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                        return _nretVal;
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    r.Skip();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityDeviceViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityDeviceViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityDevice);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityDevice _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityDevice)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityDevice)));
            }
            if (context.ShouldSerialize("deviceSecret")) {
                if ((_strong.DeviceSecret == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "deviceSecret", _strong.DeviceSecret, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("lockout")) {
                if ((_strong.LockoutXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockout", _strong.LockoutXml, context);
                }
            }
            if (context.ShouldSerialize("lockoutModel")) {
                if ((_strong.Lockout == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockoutModel", _strong.Lockout, context);
                }
            }
            if (context.ShouldSerialize("invalidAuth")) {
                if ((_strong.InvalidAuthAttempts == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "invalidAuth", _strong.InvalidAuthAttempts, context);
                }
            }
            if (context.ShouldSerialize("lastAuthenticationTime")) {
                if ((_strong.LastAuthenticationXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastAuthenticationTime", _strong.LastAuthenticationXml, context);
                }
            }
            if (context.ShouldSerialize("lastAuthenticationTimeModel")) {
                if ((_strong.LastAuthentication == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastAuthenticationTimeModel", _strong.LastAuthentication, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityDevice _retVal = new SanteDB.Core.Model.Security.SecurityDevice();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("lastAuthenticationTimeModel".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastAuthenticationTimeModel", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.LastAuthentication = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("lastAuthenticationTime".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastAuthenticationTime", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.LastAuthenticationXml = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("invalidAuth".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("invalidAuth", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.InvalidAuthAttempts = ((System.Nullable<int>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("lockoutModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockoutModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Lockout = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("lockout".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockout", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.LockoutXml = ((string)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("name".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Name = ((string)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("deviceSecret".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("deviceSecret", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.DeviceSecret = ((string)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Security.SecurityDevice))) {
                                                                                                        SanteDB.Core.Model.Security.SecurityDevice _nretVal = ((SanteDB.Core.Model.Security.SecurityDevice)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                        return _nretVal;
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    r.Skip();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityEntityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityEntityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityEntity);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityEntity _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityEntity)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityEntity)));
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityEntity _retVal = new SanteDB.Core.Model.Security.SecurityEntity();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("$type".Equals(r.Value)) {
                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                        if ((_type != typeof(SanteDB.Core.Model.Security.SecurityEntity))) {
                                                                            SanteDB.Core.Model.Security.SecurityEntity _nretVal = ((SanteDB.Core.Model.Security.SecurityEntity)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                            _nretVal.CopyObjectData(_retVal);
                                                                            return _nretVal;
                                                                        }
                                                                    }
                                                                    else {
                                                                        r.Skip();
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityPolicyViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityPolicyViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityPolicy);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityPolicy _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityPolicy)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityPolicy)));
            }
            if (context.ShouldSerialize("handler")) {
                if ((_strong.Handler == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "handler", _strong.Handler, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("isPublic")) {
                if ((_strong.IsPublic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isPublic", _strong.IsPublic, context);
                }
            }
            if (context.ShouldSerialize("canOverride")) {
                if ((_strong.CanOverride == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "canOverride", _strong.CanOverride, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityPolicy _retVal = new SanteDB.Core.Model.Security.SecurityPolicy();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("canOverride".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("canOverride", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.CanOverride = ((bool)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("isPublic".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isPublic", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.IsPublic = ((bool)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("oid".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.Oid = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("name".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Name = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("handler".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("handler", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Handler = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.Security.SecurityPolicy))) {
                                                                                    SanteDB.Core.Model.Security.SecurityPolicy _nretVal = ((SanteDB.Core.Model.Security.SecurityPolicy)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.Security.SecurityPolicy _retVal = new SanteDB.Core.Model.Security.SecurityPolicy();
            _retVal.Oid = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.Security.SecurityPolicy _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityPolicy)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Oid;
        }
    }
    
    public class SecurityPolicyInstanceViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityPolicyInstanceViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityPolicyInstance);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityPolicyInstance _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityPolicyInstance)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityPolicyInstance)));
            }
            if (context.ShouldSerialize("policy")) {
                if ((_strong.PolicyKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.PolicyKey, context);
                }
            }
            if (context.ShouldSerialize("policyModel")) {
                if ((_strong.Policy == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policyModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityPolicy _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityPolicy>(_strong.PolicyKey);
                        if ((_delay != null)) {
                            _strong.Policy = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policyModel", _strong.Policy, context);
                        }
                        else {
                            context.RegisterMissTarget("policyModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policyModel", _strong.Policy, context);
                }
            }
            if (context.ShouldSerialize("grant")) {
                if ((_strong.GrantType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "grant", _strong.GrantType, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityPolicyInstance _retVal = new SanteDB.Core.Model.Security.SecurityPolicyInstance();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityEntity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Security.SecurityEntity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("grant".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.PolicyGrantType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("grant", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.GrantType = ((SanteDB.Core.Model.Security.PolicyGrantType)(_instance));
                                    }
                                }
                                else {
                                    if ("policyModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityPolicy), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policyModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.Policy = ((SanteDB.Core.Model.Security.SecurityPolicy)(_instance));
                                        }
                                    }
                                    else {
                                        if ("policy".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.PolicyKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("$type".Equals(r.Value)) {
                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                if ((_type != typeof(SanteDB.Core.Model.Security.SecurityPolicyInstance))) {
                                                    SanteDB.Core.Model.Security.SecurityPolicyInstance _nretVal = ((SanteDB.Core.Model.Security.SecurityPolicyInstance)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                    _nretVal.CopyObjectData(_retVal);
                                                    return _nretVal;
                                                }
                                            }
                                            else {
                                                r.Skip();
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityProvenanceViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityProvenanceViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityProvenance);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityProvenance _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityProvenance)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityProvenance)));
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("application")) {
                if ((_strong.ApplicationKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "application", _strong.ApplicationKey, context);
                }
            }
            if (context.ShouldSerialize("user")) {
                if ((_strong.UserKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "user", _strong.UserKey, context);
                }
            }
            if (context.ShouldSerialize("device")) {
                if ((_strong.DeviceKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "device", _strong.DeviceKey, context);
                }
            }
            if (context.ShouldSerialize("session")) {
                if ((_strong.SessionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "session", _strong.SessionKey, context);
                }
            }
            if (context.ShouldSerialize("extern")) {
                if ((_strong.ExternalSecurityObjectRefKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extern", _strong.ExternalSecurityObjectRefKey, context);
                }
            }
            if (context.ShouldSerialize("externClass")) {
                if ((_strong.ExternalSecurityObjectRefType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "externClass", _strong.ExternalSecurityObjectRefType, context);
                }
            }
            if (context.ShouldSerialize("userModel")) {
                if ((_strong.User == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("userModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityUser _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityUser>(_strong.UserKey);
                        if ((_delay != null)) {
                            _strong.User = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "userModel", _strong.User, context);
                        }
                        else {
                            context.RegisterMissTarget("userModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "userModel", _strong.User, context);
                }
            }
            if (context.ShouldSerialize("applicationModel")) {
                if ((_strong.Application == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("applicationModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityApplication _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityApplication>(_strong.ApplicationKey);
                        if ((_delay != null)) {
                            _strong.Application = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "applicationModel", _strong.Application, context);
                        }
                        else {
                            context.RegisterMissTarget("applicationModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "applicationModel", _strong.Application, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityProvenance _retVal = new SanteDB.Core.Model.Security.SecurityProvenance();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("applicationModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityApplication), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("applicationModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.Application = ((SanteDB.Core.Model.Security.SecurityApplication)(_instance));
                            }
                        }
                        else {
                            if ("userModel".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityUser), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("userModel", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.User = ((SanteDB.Core.Model.Security.SecurityUser)(_instance));
                                }
                            }
                            else {
                                if ("externClass".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("externClass", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ExternalSecurityObjectRefType = ((string)(_instance));
                                    }
                                }
                                else {
                                    if ("extern".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extern", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.ExternalSecurityObjectRefKey = ((System.Nullable<System.Guid>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("session".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("session", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.SessionKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("device".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("device", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.DeviceKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("user".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("user", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.UserKey = ((System.Nullable<System.Guid>)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("application".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("application", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ApplicationKey = ((System.Nullable<System.Guid>)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("creationTime".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.CreationTimeXml = ((string)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("creationTimeModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("$type".Equals(r.Value)) {
                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                    if ((_type != typeof(SanteDB.Core.Model.Security.SecurityProvenance))) {
                                                                        SanteDB.Core.Model.Security.SecurityProvenance _nretVal = ((SanteDB.Core.Model.Security.SecurityProvenance)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                        _nretVal.CopyObjectData(_retVal);
                                                                        return _nretVal;
                                                                    }
                                                                }
                                                                else {
                                                                    r.Skip();
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityRoleViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityRoleViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityRole);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityRole _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityRole)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityRole)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("description")) {
                if ((_strong.Description == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "description", _strong.Description, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityRole _retVal = new SanteDB.Core.Model.Security.SecurityRole();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("description".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("description", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Description = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("name".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Name = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.Security.SecurityRole))) {
                                                                                    SanteDB.Core.Model.Security.SecurityRole _nretVal = ((SanteDB.Core.Model.Security.SecurityRole)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SecurityUserViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SecurityUserViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Security.SecurityUser);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Security.SecurityUser _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Security.SecurityUser)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Security.SecurityUser)));
            }
            if (context.ShouldSerialize("email")) {
                if ((_strong.Email == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "email", _strong.Email, context);
                }
            }
            if (context.ShouldSerialize("emailConfirmed")) {
                if ((_strong.EmailConfirmed == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "emailConfirmed", _strong.EmailConfirmed, context);
                }
            }
            if (context.ShouldSerialize("invalidLoginAttempts")) {
                if ((_strong.InvalidLoginAttempts == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "invalidLoginAttempts", _strong.InvalidLoginAttempts, context);
                }
            }
            if (context.ShouldSerialize("lockoutModel")) {
                if ((_strong.Lockout == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockoutModel", _strong.Lockout, context);
                }
            }
            if (context.ShouldSerialize("lockout")) {
                if ((_strong.LockoutXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lockout", _strong.LockoutXml, context);
                }
            }
            if (context.ShouldSerialize("password")) {
                if ((_strong.Password == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "password", _strong.Password, context);
                }
            }
            if (context.ShouldSerialize("securityStamp")) {
                if ((_strong.SecurityHash == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityStamp", _strong.SecurityHash, context);
                }
            }
            if (context.ShouldSerialize("twoFactorEnabled")) {
                if ((_strong.TwoFactorEnabled == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "twoFactorEnabled", _strong.TwoFactorEnabled, context);
                }
            }
            if (context.ShouldSerialize("userName")) {
                if ((_strong.UserName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "userName", _strong.UserName, context);
                }
            }
            if (context.ShouldSerialize("photo")) {
                if ((_strong.UserPhoto == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "photo", _strong.UserPhoto, context);
                }
            }
            if (context.ShouldSerialize("lastLoginTimeModel")) {
                if ((_strong.LastLoginTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastLoginTimeModel", _strong.LastLoginTime, context);
                }
            }
            if (context.ShouldSerialize("lastLoginTime")) {
                if ((_strong.LastLoginTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lastLoginTime", _strong.LastLoginTimeXml, context);
                }
            }
            if (context.ShouldSerialize("phoneNumber")) {
                if ((_strong.PhoneNumber == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneNumber", _strong.PhoneNumber, context);
                }
            }
            if (context.ShouldSerialize("phoneNumberConfirmed")) {
                if ((_strong.PhoneNumberConfirmed == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneNumberConfirmed", _strong.PhoneNumberConfirmed, context);
                }
            }
            if (context.ShouldSerialize("userClass")) {
                if ((_strong.UserClass == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "userClass", _strong.UserClass, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Security.SecurityUser _retVal = new SanteDB.Core.Model.Security.SecurityUser();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("userClass".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Guid), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("userClass", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.UserClass = ((System.Guid)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("phoneNumberConfirmed".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneNumberConfirmed", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.PhoneNumberConfirmed = ((bool)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("phoneNumber".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneNumber", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.PhoneNumber = ((string)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("lastLoginTime".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastLoginTime", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.LastLoginTimeXml = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("lastLoginTimeModel".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lastLoginTimeModel", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.LastLoginTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("photo".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(byte[]), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("photo", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.UserPhoto = ((byte[])(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("userName".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("userName", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.UserName = ((string)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("twoFactorEnabled".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("twoFactorEnabled", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.TwoFactorEnabled = ((bool)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("securityStamp".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityStamp", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.SecurityHash = ((string)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("password".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("password", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Password = ((string)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("lockout".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockout", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.LockoutXml = ((string)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("lockoutModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTime>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lockoutModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Lockout = ((System.Nullable<System.DateTime>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("invalidLoginAttempts".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("invalidLoginAttempts", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.InvalidLoginAttempts = ((int)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("emailConfirmed".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("emailConfirmed", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.EmailConfirmed = ((bool)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("email".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("email", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Email = ((string)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Security.SecurityUser))) {
                                                                                                                                        SanteDB.Core.Model.Security.SecurityUser _nretVal = ((SanteDB.Core.Model.Security.SecurityUser)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                        return _nretVal;
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    r.Skip();
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PatientViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PatientViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Roles.Patient);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Roles.Patient _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Roles.Patient)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Roles.Patient)));
            }
            if (context.ShouldSerialize("deceasedDate")) {
                if ((_strong.DeceasedDateXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "deceasedDate", _strong.DeceasedDateXml, context);
                }
            }
            if (context.ShouldSerialize("deceasedDatePrecision")) {
                if ((_strong.DeceasedDatePrecision == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "deceasedDatePrecision", _strong.DeceasedDatePrecision, context);
                }
            }
            if (context.ShouldSerialize("multipleBirthOrder")) {
                if ((_strong.MultipleBirthOrder == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "multipleBirthOrder", _strong.MultipleBirthOrder, context);
                }
            }
            if (context.ShouldSerialize("genderConcept")) {
                if ((_strong.GenderConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "genderConcept", _strong.GenderConceptKey, context);
                }
            }
            if (context.ShouldSerialize("genderConceptModel")) {
                if ((_strong.GenderConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("genderConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.GenderConceptKey);
                        if ((_delay != null)) {
                            _strong.GenderConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "genderConceptModel", _strong.GenderConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("genderConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "genderConceptModel", _strong.GenderConcept, context);
                }
            }
            if (context.ShouldSerialize("maritalStatus")) {
                if ((_strong.MaritalStatusKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "maritalStatus", _strong.MaritalStatusKey, context);
                }
            }
            if (context.ShouldSerialize("educationLevel")) {
                if ((_strong.EducationLevelKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "educationLevel", _strong.EducationLevelKey, context);
                }
            }
            if (context.ShouldSerialize("livingArrangement")) {
                if ((_strong.LivingArrangementKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "livingArrangement", _strong.LivingArrangementKey, context);
                }
            }
            if (context.ShouldSerialize("religion")) {
                if ((_strong.ReligiousAffiliationKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "religion", _strong.ReligiousAffiliationKey, context);
                }
            }
            if (context.ShouldSerialize("maritalStatusModel")) {
                if ((_strong.MaritalStatus == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("maritalStatusModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MaritalStatusKey);
                        if ((_delay != null)) {
                            _strong.MaritalStatus = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "maritalStatusModel", _strong.MaritalStatus, context);
                        }
                        else {
                            context.RegisterMissTarget("maritalStatusModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "maritalStatusModel", _strong.MaritalStatus, context);
                }
            }
            if (context.ShouldSerialize("educationLevelModel")) {
                if ((_strong.EducationLevel == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("educationLevelModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.EducationLevelKey);
                        if ((_delay != null)) {
                            _strong.EducationLevel = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "educationLevelModel", _strong.EducationLevel, context);
                        }
                        else {
                            context.RegisterMissTarget("educationLevelModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "educationLevelModel", _strong.EducationLevel, context);
                }
            }
            if (context.ShouldSerialize("livingArrangementModel")) {
                if ((_strong.LivingArrangement == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("livingArrangementModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.LivingArrangementKey);
                        if ((_delay != null)) {
                            _strong.LivingArrangement = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "livingArrangementModel", _strong.LivingArrangement, context);
                        }
                        else {
                            context.RegisterMissTarget("livingArrangementModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "livingArrangementModel", _strong.LivingArrangement, context);
                }
            }
            if (context.ShouldSerialize("religionModel")) {
                if ((_strong.ReligiousAffiliation == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("religionModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReligiousAffiliationKey);
                        if ((_delay != null)) {
                            _strong.ReligiousAffiliation = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "religionModel", _strong.ReligiousAffiliation, context);
                        }
                        else {
                            context.RegisterMissTarget("religionModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "religionModel", _strong.ReligiousAffiliation, context);
                }
            }
            if (context.ShouldSerialize("ethnicity")) {
                if ((_strong.EthnicGroupCodeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "ethnicity", _strong.EthnicGroupCodeKey, context);
                }
            }
            if (context.ShouldSerialize("ethnicityModel")) {
                if ((_strong.EthnicGroup == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("ethnicityModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.EthnicGroupCodeKey);
                        if ((_delay != null)) {
                            _strong.EthnicGroup = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "ethnicityModel", _strong.EthnicGroup, context);
                        }
                        else {
                            context.RegisterMissTarget("ethnicityModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "ethnicityModel", _strong.EthnicGroup, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirthPrecision")) {
                if ((_strong.DateOfBirthPrecision == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirthPrecision", _strong.DateOfBirthPrecision, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirth")) {
                if ((_strong.DateOfBirthXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirth", _strong.DateOfBirthXml, context);
                }
            }
            if (context.ShouldSerialize("language")) {
                if (((_strong.LanguageCommunication == null) 
                            || (_strong.LanguageCommunication.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("language", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.LanguageCommunication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                        }
                        else {
                            context.RegisterMissTarget("language", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Roles.Patient _retVal = new SanteDB.Core.Model.Roles.Patient();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("language".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.LanguageCommunication = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("dateOfBirth".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirth", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.DateOfBirthXml = ((string)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("dateOfBirthPrecision".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirthPrecision", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.DateOfBirthPrecision = ((System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("ethnicityModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("ethnicityModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.EthnicGroup = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("ethnicity".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("ethnicity", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.EthnicGroupCodeKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("religionModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("religionModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.ReligiousAffiliation = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("livingArrangementModel".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("livingArrangementModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.LivingArrangement = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("educationLevelModel".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("educationLevelModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.EducationLevel = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("maritalStatusModel".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("maritalStatusModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.MaritalStatus = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("religion".Equals(r.Value)) {
                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("religion", context.JsonContext, _retVal, context));
                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                        _retVal.ReligiousAffiliationKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    if ("livingArrangement".Equals(r.Value)) {
                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("livingArrangement", context.JsonContext, _retVal, context));
                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                            _retVal.LivingArrangementKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                    else {
                                                                                                                                                                                                        if ("educationLevel".Equals(r.Value)) {
                                                                                                                                                                                                            r.Read();
                                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("educationLevel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                                _retVal.EducationLevelKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                        else {
                                                                                                                                                                                                            if ("maritalStatus".Equals(r.Value)) {
                                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("maritalStatus", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                                    _retVal.MaritalStatusKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                            else {
                                                                                                                                                                                                                if ("genderConceptModel".Equals(r.Value)) {
                                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("genderConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                                        _retVal.GenderConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                }
                                                                                                                                                                                                                else {
                                                                                                                                                                                                                    if ("genderConcept".Equals(r.Value)) {
                                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("genderConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                                            _retVal.GenderConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    else {
                                                                                                                                                                                                                        if ("multipleBirthOrder".Equals(r.Value)) {
                                                                                                                                                                                                                            r.Read();
                                                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("multipleBirthOrder", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                                                _retVal.MultipleBirthOrder = ((System.Nullable<int>)(_instance));
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        else {
                                                                                                                                                                                                                            if ("deceasedDatePrecision".Equals(r.Value)) {
                                                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("deceasedDatePrecision", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                                                    _retVal.DeceasedDatePrecision = ((System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>)(_instance));
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            else {
                                                                                                                                                                                                                                if ("deceasedDate".Equals(r.Value)) {
                                                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("deceasedDate", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                                                        _retVal.DeceasedDateXml = ((string)(_instance));
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                else {
                                                                                                                                                                                                                                    if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                                                        if ((_type != typeof(SanteDB.Core.Model.Roles.Patient))) {
                                                                                                                                                                                                                                            SanteDB.Core.Model.Roles.Patient _nretVal = ((SanteDB.Core.Model.Roles.Patient)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                                                            return _nretVal;
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                    else {
                                                                                                                                                                                                                                        r.Skip();
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ProviderViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ProviderViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Roles.Provider);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Roles.Provider _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Roles.Provider)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Roles.Provider)));
            }
            if (context.ShouldSerialize("providerSpecialty")) {
                if ((_strong.ProviderSpecialtyKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "providerSpecialty", _strong.ProviderSpecialtyKey, context);
                }
            }
            if (context.ShouldSerialize("providerSpecialtyModel")) {
                if ((_strong.ProviderSpecialty == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("providerSpecialtyModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ProviderSpecialtyKey);
                        if ((_delay != null)) {
                            _strong.ProviderSpecialty = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "providerSpecialtyModel", _strong.ProviderSpecialty, context);
                        }
                        else {
                            context.RegisterMissTarget("providerSpecialtyModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "providerSpecialtyModel", _strong.ProviderSpecialty, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirthPrecision")) {
                if ((_strong.DateOfBirthPrecision == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirthPrecision", _strong.DateOfBirthPrecision, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirth")) {
                if ((_strong.DateOfBirthXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirth", _strong.DateOfBirthXml, context);
                }
            }
            if (context.ShouldSerialize("language")) {
                if (((_strong.LanguageCommunication == null) 
                            || (_strong.LanguageCommunication.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("language", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.LanguageCommunication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                        }
                        else {
                            context.RegisterMissTarget("language", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Roles.Provider _retVal = new SanteDB.Core.Model.Roles.Provider();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("language".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.LanguageCommunication = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("dateOfBirth".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirth", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.DateOfBirthXml = ((string)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("dateOfBirthPrecision".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirthPrecision", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.DateOfBirthPrecision = ((System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("providerSpecialtyModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("providerSpecialtyModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.ProviderSpecialty = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("providerSpecialty".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("providerSpecialty", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.ProviderSpecialtyKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Roles.Provider))) {
                                                                                                                                                                                        SanteDB.Core.Model.Roles.Provider _nretVal = ((SanteDB.Core.Model.Roles.Provider)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PatchViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PatchViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Patch.Patch);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Patch.Patch _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Patch.Patch)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Patch.Patch)));
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.Version == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.Version, context);
                }
            }
            if (context.ShouldSerialize("appliesTo")) {
                if ((_strong.AppliesTo == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "appliesTo", _strong.AppliesTo, context);
                }
            }
            if (context.ShouldSerialize("change")) {
                if (((_strong.Operation == null) 
                            || (_strong.Operation.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "change", _strong.Operation, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Patch.Patch _retVal = new SanteDB.Core.Model.Patch.Patch();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("change".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Patch.PatchOperation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("change", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.Operation = ((System.Collections.Generic.List<SanteDB.Core.Model.Patch.PatchOperation>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("appliesTo".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Patch.PatchTarget), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("appliesTo", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.AppliesTo = ((SanteDB.Core.Model.Patch.PatchTarget)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("version".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.Version = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("$type".Equals(r.Value)) {
                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                        if ((_type != typeof(SanteDB.Core.Model.Patch.Patch))) {
                                                                            SanteDB.Core.Model.Patch.Patch _nretVal = ((SanteDB.Core.Model.Patch.Patch)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                            _nretVal.CopyObjectData(_retVal);
                                                                            return _nretVal;
                                                                        }
                                                                    }
                                                                    else {
                                                                        r.Skip();
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ContainerViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ContainerViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Container);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Container _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Container)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Container)));
            }
            if (context.ShouldSerialize("barrierDeltaQuantity")) {
                if ((_strong.BarrierDeltaQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "barrierDeltaQuantity", _strong.BarrierDeltaQuantity, context);
                }
            }
            if (context.ShouldSerialize("bottomDeltaQuantity")) {
                if ((_strong.BottomDeltaQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "bottomDeltaQuantity", _strong.BottomDeltaQuantity, context);
                }
            }
            if (context.ShouldSerialize("capacityQuantity")) {
                if ((_strong.CapacityQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "capacityQuantity", _strong.CapacityQuantity, context);
                }
            }
            if (context.ShouldSerialize("capTypeConceptModel")) {
                if ((_strong.CapTypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("capTypeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.CapTypeConceptKey);
                        if ((_delay != null)) {
                            _strong.CapTypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "capTypeConceptModel", _strong.CapTypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("capTypeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "capTypeConceptModel", _strong.CapTypeConcept, context);
                }
            }
            if (context.ShouldSerialize("capTypeConcept")) {
                if ((_strong.CapTypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "capTypeConcept", _strong.CapTypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("diameterQuantity")) {
                if ((_strong.DiameterQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "diameterQuantity", _strong.DiameterQuantity, context);
                }
            }
            if (context.ShouldSerialize("heightQuantity")) {
                if ((_strong.HeightQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "heightQuantity", _strong.HeightQuantity, context);
                }
            }
            if (context.ShouldSerialize("separatorTypeConceptModel")) {
                if ((_strong.SeparatorTypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("separatorTypeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.SeparatorTypeConceptKey);
                        if ((_delay != null)) {
                            _strong.SeparatorTypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "separatorTypeConceptModel", _strong.SeparatorTypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("separatorTypeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "separatorTypeConceptModel", _strong.SeparatorTypeConcept, context);
                }
            }
            if (context.ShouldSerialize("separatorTypeConcept")) {
                if ((_strong.SeparatorTypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "separatorTypeConcept", _strong.SeparatorTypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("lotNumber")) {
                if ((_strong.LotNumber == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lotNumber", _strong.LotNumber, context);
                }
            }
            if (context.ShouldSerialize("expiryDate")) {
                if ((_strong.ExpiryDate == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "expiryDate", _strong.ExpiryDate, context);
                }
            }
            if (context.ShouldSerialize("formConceptModel")) {
                if ((_strong.FormConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("formConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.FormConceptKey);
                        if ((_delay != null)) {
                            _strong.FormConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("formConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                }
            }
            if (context.ShouldSerialize("formConcept")) {
                if ((_strong.FormConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConcept", _strong.FormConceptKey, context);
                }
            }
            if (context.ShouldSerialize("isAdministrative")) {
                if ((_strong.IsAdministrative == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isAdministrative", _strong.IsAdministrative, context);
                }
            }
            if (context.ShouldSerialize("quantity")) {
                if ((_strong.Quantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantity", _strong.Quantity, context);
                }
            }
            if (context.ShouldSerialize("quantityConceptModel")) {
                if ((_strong.QuantityConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("quantityConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.QuantityConceptKey);
                        if ((_delay != null)) {
                            _strong.QuantityConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("quantityConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                }
            }
            if (context.ShouldSerialize("quantityConcept")) {
                if ((_strong.QuantityConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConcept", _strong.QuantityConceptKey, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Container _retVal = new SanteDB.Core.Model.Entities.Container();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("quantityConcept".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.QuantityConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("quantityConceptModel".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.QuantityConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("quantity".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantity", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.Quantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("isAdministrative".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isAdministrative", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.IsAdministrative = ((bool)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("formConcept".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.FormConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("formConceptModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.FormConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("expiryDate".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTime>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("expiryDate", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.ExpiryDate = ((System.Nullable<System.DateTime>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("lotNumber".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lotNumber", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.LotNumber = ((string)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("separatorTypeConcept".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("separatorTypeConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.SeparatorTypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("separatorTypeConceptModel".Equals(r.Value)) {
                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("separatorTypeConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                        _retVal.SeparatorTypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    if ("heightQuantity".Equals(r.Value)) {
                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("heightQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                            _retVal.HeightQuantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                    else {
                                                                                                                                                                                                        if ("diameterQuantity".Equals(r.Value)) {
                                                                                                                                                                                                            r.Read();
                                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("diameterQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                                _retVal.DiameterQuantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                        else {
                                                                                                                                                                                                            if ("capTypeConcept".Equals(r.Value)) {
                                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("capTypeConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                                    _retVal.CapTypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                            else {
                                                                                                                                                                                                                if ("capTypeConceptModel".Equals(r.Value)) {
                                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("capTypeConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                                        _retVal.CapTypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                }
                                                                                                                                                                                                                else {
                                                                                                                                                                                                                    if ("capacityQuantity".Equals(r.Value)) {
                                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("capacityQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                                            _retVal.CapacityQuantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    else {
                                                                                                                                                                                                                        if ("bottomDeltaQuantity".Equals(r.Value)) {
                                                                                                                                                                                                                            r.Read();
                                                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("bottomDeltaQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                                                _retVal.BottomDeltaQuantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        else {
                                                                                                                                                                                                                            if ("barrierDeltaQuantity".Equals(r.Value)) {
                                                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("barrierDeltaQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                                                    _retVal.BarrierDeltaQuantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            else {
                                                                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Entities.Container))) {
                                                                                                                                                                                                                                        SanteDB.Core.Model.Entities.Container _nretVal = ((SanteDB.Core.Model.Entities.Container)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                else {
                                                                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class UserEntityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(UserEntityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.UserEntity);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.UserEntity _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.UserEntity)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.UserEntity)));
            }
            if (context.ShouldSerialize("securityUser")) {
                if ((_strong.SecurityUserKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityUser", _strong.SecurityUserKey, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirthPrecision")) {
                if ((_strong.DateOfBirthPrecision == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirthPrecision", _strong.DateOfBirthPrecision, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirth")) {
                if ((_strong.DateOfBirthXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirth", _strong.DateOfBirthXml, context);
                }
            }
            if (context.ShouldSerialize("language")) {
                if (((_strong.LanguageCommunication == null) 
                            || (_strong.LanguageCommunication.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("language", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.LanguageCommunication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                        }
                        else {
                            context.RegisterMissTarget("language", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.UserEntity _retVal = new SanteDB.Core.Model.Entities.UserEntity();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("language".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.LanguageCommunication = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("dateOfBirth".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirth", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.DateOfBirthXml = ((string)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("dateOfBirthPrecision".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirthPrecision", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.DateOfBirthPrecision = ((System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("securityUser".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityUser", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.SecurityUserKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("securityUserModel".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityUser), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityUserModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.SecurityUser = ((SanteDB.Core.Model.Security.SecurityUser)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Entities.UserEntity))) {
                                                                                                                                                                                        SanteDB.Core.Model.Entities.UserEntity _nretVal = ((SanteDB.Core.Model.Entities.UserEntity)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ApplicationEntityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ApplicationEntityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.ApplicationEntity);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.ApplicationEntity _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.ApplicationEntity)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.ApplicationEntity)));
            }
            if (context.ShouldSerialize("securityApplicationModel")) {
                if ((_strong.SecurityApplication == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("securityApplicationModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityApplication _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityApplication>(_strong.SecurityApplicationKey);
                        if ((_delay != null)) {
                            _strong.SecurityApplication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "securityApplicationModel", _strong.SecurityApplication, context);
                        }
                        else {
                            context.RegisterMissTarget("securityApplicationModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityApplicationModel", _strong.SecurityApplication, context);
                }
            }
            if (context.ShouldSerialize("securityApplication")) {
                if ((_strong.SecurityApplicationKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityApplication", _strong.SecurityApplicationKey, context);
                }
            }
            if (context.ShouldSerialize("softwareName")) {
                if ((_strong.SoftwareName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "softwareName", _strong.SoftwareName, context);
                }
            }
            if (context.ShouldSerialize("vendorName")) {
                if ((_strong.VendorName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "vendorName", _strong.VendorName, context);
                }
            }
            if (context.ShouldSerialize("versionName")) {
                if ((_strong.VersionName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "versionName", _strong.VersionName, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.ApplicationEntity _retVal = new SanteDB.Core.Model.Entities.ApplicationEntity();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("versionName".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("versionName", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.VersionName = ((string)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("vendorName".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("vendorName", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.VendorName = ((string)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("softwareName".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("softwareName", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.SoftwareName = ((string)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("securityApplication".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityApplication", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.SecurityApplicationKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("securityApplicationModel".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityApplication), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityApplicationModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.SecurityApplication = ((SanteDB.Core.Model.Security.SecurityApplication)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Entities.ApplicationEntity))) {
                                                                                                                                                                                        SanteDB.Core.Model.Entities.ApplicationEntity _nretVal = ((SanteDB.Core.Model.Entities.ApplicationEntity)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class DeviceEntityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(DeviceEntityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.DeviceEntity);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.DeviceEntity _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.DeviceEntity)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.DeviceEntity)));
            }
            if (context.ShouldSerialize("manufacturerModelName")) {
                if ((_strong.ManufacturerModelName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "manufacturerModelName", _strong.ManufacturerModelName, context);
                }
            }
            if (context.ShouldSerialize("operatingSystemName")) {
                if ((_strong.OperatingSystemName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "operatingSystemName", _strong.OperatingSystemName, context);
                }
            }
            if (context.ShouldSerialize("securityDeviceModel")) {
                if ((_strong.SecurityDevice == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("securityDeviceModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityDevice _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityDevice>(_strong.SecurityDeviceKey);
                        if ((_delay != null)) {
                            _strong.SecurityDevice = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "securityDeviceModel", _strong.SecurityDevice, context);
                        }
                        else {
                            context.RegisterMissTarget("securityDeviceModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityDeviceModel", _strong.SecurityDevice, context);
                }
            }
            if (context.ShouldSerialize("securityDevice")) {
                if ((_strong.SecurityDeviceKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "securityDevice", _strong.SecurityDeviceKey, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.DeviceEntity _retVal = new SanteDB.Core.Model.Entities.DeviceEntity();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("geo".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("securityDevice".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityDevice", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.SecurityDeviceKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("securityDeviceModel".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityDevice), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("securityDeviceModel", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.SecurityDevice = ((SanteDB.Core.Model.Security.SecurityDevice)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("operatingSystemName".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("operatingSystemName", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.OperatingSystemName = ((string)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("manufacturerModelName".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("manufacturerModelName", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.ManufacturerModelName = ((string)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Entities.DeviceEntity))) {
                                                                                                                                                                                        SanteDB.Core.Model.Entities.DeviceEntity _nretVal = ((SanteDB.Core.Model.Entities.DeviceEntity)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Entity);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Entity _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Entity)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Entity)));
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Entity _retVal = new SanteDB.Core.Model.Entities.Entity();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("telecom".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("tag".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("statusConceptModel".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("relationship".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("participation".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("note".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("name".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("identifier".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("extension".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("creationActModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("address".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("typeConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("template".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("statusConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("creationAct".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("classConcept".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                if ((_type != typeof(SanteDB.Core.Model.Entities.Entity))) {
                                                                                                                                                                    SanteDB.Core.Model.Entities.Entity _nretVal = ((SanteDB.Core.Model.Entities.Entity)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                    return _nretVal;
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                r.Skip();
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityAddressViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityAddressViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityAddress);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityAddress _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityAddress)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityAddress)));
            }
            if (context.ShouldSerialize("useModel")) {
                if ((_strong.AddressUse == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("useModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.AddressUseKey);
                        if ((_delay != null)) {
                            _strong.AddressUse = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "useModel", _strong.AddressUse, context);
                        }
                        else {
                            context.RegisterMissTarget("useModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "useModel", _strong.AddressUse, context);
                }
            }
            if (context.ShouldSerialize("use")) {
                if ((_strong.AddressUseKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "use", _strong.AddressUseKey, context);
                }
            }
            if (context.ShouldSerialize("component")) {
                if (((_strong.Component == null) 
                            || (_strong.Component.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("component", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddressComponent> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddressComponent>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddressComponent>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Component = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "component", _strong.Component, context);
                        }
                        else {
                            context.RegisterMissTarget("component", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "component", _strong.Component, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityAddress _retVal = new SanteDB.Core.Model.Entities.EntityAddress();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("component".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddressComponent>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("component", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Component = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddressComponent>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("use".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("use", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.AddressUseKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("useModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("useModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.AddressUse = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.Entities.EntityAddress))) {
                                                            SanteDB.Core.Model.Entities.EntityAddress _nretVal = ((SanteDB.Core.Model.Entities.EntityAddress)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class AddressComponentViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(AddressComponentViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityAddressComponent);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityAddressComponent _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityAddressComponent)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityAddressComponent)));
            }
            if (context.ShouldSerialize("type")) {
                if ((_strong.ComponentTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "type", _strong.ComponentTypeKey, context);
                }
            }
            if (context.ShouldSerialize("typeModel")) {
                if ((_strong.ComponentType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ComponentTypeKey);
                        if ((_delay != null)) {
                            _strong.ComponentType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeModel", _strong.ComponentType, context);
                        }
                        else {
                            context.RegisterMissTarget("typeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeModel", _strong.ComponentType, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityAddressComponent _retVal = new SanteDB.Core.Model.Entities.EntityAddressComponent();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.EntityAddress), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.EntityAddress)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("value".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.Value = ((string)(_instance));
                                    }
                                }
                                else {
                                    if ("typeModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.ComponentType = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                        }
                                    }
                                    else {
                                        if ("type".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("type", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ComponentTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("$type".Equals(r.Value)) {
                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                if ((_type != typeof(SanteDB.Core.Model.Entities.EntityAddressComponent))) {
                                                    SanteDB.Core.Model.Entities.EntityAddressComponent _nretVal = ((SanteDB.Core.Model.Entities.EntityAddressComponent)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                    _nretVal.CopyObjectData(_retVal);
                                                    return _nretVal;
                                                }
                                            }
                                            else {
                                                r.Skip();
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.Entities.EntityAddressComponent _retVal = new SanteDB.Core.Model.Entities.EntityAddressComponent();
            _retVal.Value = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.Entities.EntityAddressComponent _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityAddressComponent)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Value;
        }
    }
    
    public class EntityNameViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityNameViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityName);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityName _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityName)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityName)));
            }
            if (context.ShouldSerialize("component")) {
                if (((_strong.Component == null) 
                            || (_strong.Component.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("component", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityNameComponent> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityNameComponent>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityNameComponent>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Component = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "component", _strong.Component, context);
                        }
                        else {
                            context.RegisterMissTarget("component", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "component", _strong.Component, context);
                }
            }
            if (context.ShouldSerialize("useModel")) {
                if ((_strong.NameUse == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("useModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.NameUseKey);
                        if ((_delay != null)) {
                            _strong.NameUse = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "useModel", _strong.NameUse, context);
                        }
                        else {
                            context.RegisterMissTarget("useModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "useModel", _strong.NameUse, context);
                }
            }
            if (context.ShouldSerialize("use")) {
                if ((_strong.NameUseKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "use", _strong.NameUseKey, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityName _retVal = new SanteDB.Core.Model.Entities.EntityName();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("use".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("use", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.NameUseKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("useModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("useModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.NameUse = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                }
                                            }
                                            else {
                                                if ("component".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityNameComponent>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("component", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Component = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityNameComponent>)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.Entities.EntityName))) {
                                                            SanteDB.Core.Model.Entities.EntityName _nretVal = ((SanteDB.Core.Model.Entities.EntityName)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityNameComponentViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityNameComponentViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityNameComponent);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityNameComponent _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityNameComponent)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityNameComponent)));
            }
            if (context.ShouldSerialize("type")) {
                if ((_strong.ComponentTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "type", _strong.ComponentTypeKey, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithmModel")) {
                if ((_strong.PhoneticAlgorithm == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("phoneticAlgorithmModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.PhoneticAlgorithm>(_strong.PhoneticAlgorithmKey);
                        if ((_delay != null)) {
                            _strong.PhoneticAlgorithm = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                        }
                        else {
                            context.RegisterMissTarget("phoneticAlgorithmModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithm")) {
                if ((_strong.PhoneticAlgorithmKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithm", _strong.PhoneticAlgorithmKey, context);
                }
            }
            if (context.ShouldSerialize("phoneticCode")) {
                if ((_strong.PhoneticCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticCode", _strong.PhoneticCode, context);
                }
            }
            if (context.ShouldSerialize("typeModel")) {
                if ((_strong.ComponentType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ComponentTypeKey);
                        if ((_delay != null)) {
                            _strong.ComponentType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeModel", _strong.ComponentType, context);
                        }
                        else {
                            context.RegisterMissTarget("typeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeModel", _strong.ComponentType, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityNameComponent _retVal = new SanteDB.Core.Model.Entities.EntityNameComponent();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.EntityName), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.EntityName)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("value".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.Value = ((string)(_instance));
                                    }
                                }
                                else {
                                    if ("typeModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.ComponentType = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                        }
                                    }
                                    else {
                                        if ("phoneticCode".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticCode", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.PhoneticCode = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("phoneticAlgorithm".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithm", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.PhoneticAlgorithmKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("phoneticAlgorithmModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithmModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.PhoneticAlgorithm = ((SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("type".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("type", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ComponentTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.Entities.EntityNameComponent))) {
                                                                SanteDB.Core.Model.Entities.EntityNameComponent _nretVal = ((SanteDB.Core.Model.Entities.EntityNameComponent)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.Entities.EntityNameComponent _retVal = new SanteDB.Core.Model.Entities.EntityNameComponent();
            _retVal.Value = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.Entities.EntityNameComponent _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityNameComponent)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Value;
        }
    }
    
    public class EntityRelationshipViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityRelationshipViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityRelationship);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityRelationship _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityRelationship)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityRelationship)));
            }
            if (context.ShouldSerialize("holder")) {
                if ((_strong.HolderKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "holder", _strong.HolderKey, context);
                }
            }
            if (context.ShouldSerialize("inversionInd")) {
                if ((_strong.InversionIndicator == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "inversionInd", _strong.InversionIndicator, context);
                }
            }
            if (context.ShouldSerialize("quantity")) {
                if ((_strong.Quantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantity", _strong.Quantity, context);
                }
            }
            if (context.ShouldSerialize("relationshipTypeModel")) {
                if ((_strong.RelationshipType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationshipTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.RelationshipTypeKey);
                        if ((_delay != null)) {
                            _strong.RelationshipType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                        }
                        else {
                            context.RegisterMissTarget("relationshipTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                }
            }
            if (context.ShouldSerialize("relationshipType")) {
                if ((_strong.RelationshipTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipType", _strong.RelationshipTypeKey, context);
                }
            }
            if (context.ShouldSerialize("targetModel")) {
                if ((_strong.TargetEntity == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("targetModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Entities.Entity _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Entities.Entity>(_strong.TargetEntityKey);
                        if ((_delay != null)) {
                            _strong.TargetEntity = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "targetModel", _strong.TargetEntity, context);
                        }
                        else {
                            context.RegisterMissTarget("targetModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetModel", _strong.TargetEntity, context);
                }
            }
            if (context.ShouldSerialize("target")) {
                if ((_strong.TargetEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "target", _strong.TargetEntityKey, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityRelationship _retVal = new SanteDB.Core.Model.Entities.EntityRelationship();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("target".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("target", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.TargetEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("targetModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.TargetEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                                }
                                            }
                                            else {
                                                if ("relationshipType".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipType", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.RelationshipTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("relationshipTypeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipTypeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.RelationshipType = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("quantity".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantity", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.Quantity = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("inversionInd".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("inversionInd", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.InversionIndicator = ((bool)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("holder".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("holder", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.HolderKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("holderModel".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("holderModel", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Holder = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("$type".Equals(r.Value)) {
                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                            if ((_type != typeof(SanteDB.Core.Model.Entities.EntityRelationship))) {
                                                                                SanteDB.Core.Model.Entities.EntityRelationship _nretVal = ((SanteDB.Core.Model.Entities.EntityRelationship)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                return _nretVal;
                                                                            }
                                                                        }
                                                                        else {
                                                                            r.Skip();
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityTelecomAddressViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityTelecomAddressViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.EntityTelecomAddress);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.EntityTelecomAddress _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.EntityTelecomAddress)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.EntityTelecomAddress)));
            }
            if (context.ShouldSerialize("useModel")) {
                if ((_strong.AddressUse == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("useModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.AddressUseKey);
                        if ((_delay != null)) {
                            _strong.AddressUse = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "useModel", _strong.AddressUse, context);
                        }
                        else {
                            context.RegisterMissTarget("useModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "useModel", _strong.AddressUse, context);
                }
            }
            if (context.ShouldSerialize("use")) {
                if ((_strong.AddressUseKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "use", _strong.AddressUseKey, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.EntityTelecomAddress _retVal = new SanteDB.Core.Model.Entities.EntityTelecomAddress();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("value".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Value = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("use".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("use", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.AddressUseKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("useModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("useModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.AddressUse = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.Entities.EntityTelecomAddress))) {
                                                            SanteDB.Core.Model.Entities.EntityTelecomAddress _nretVal = ((SanteDB.Core.Model.Entities.EntityTelecomAddress)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ManufacturedMaterialViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ManufacturedMaterialViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.ManufacturedMaterial);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.ManufacturedMaterial _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.ManufacturedMaterial)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.ManufacturedMaterial)));
            }
            if (context.ShouldSerialize("lotNumber")) {
                if ((_strong.LotNumber == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "lotNumber", _strong.LotNumber, context);
                }
            }
            if (context.ShouldSerialize("expiryDate")) {
                if ((_strong.ExpiryDate == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "expiryDate", _strong.ExpiryDate, context);
                }
            }
            if (context.ShouldSerialize("formConceptModel")) {
                if ((_strong.FormConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("formConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.FormConceptKey);
                        if ((_delay != null)) {
                            _strong.FormConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("formConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                }
            }
            if (context.ShouldSerialize("formConcept")) {
                if ((_strong.FormConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConcept", _strong.FormConceptKey, context);
                }
            }
            if (context.ShouldSerialize("isAdministrative")) {
                if ((_strong.IsAdministrative == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isAdministrative", _strong.IsAdministrative, context);
                }
            }
            if (context.ShouldSerialize("quantity")) {
                if ((_strong.Quantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantity", _strong.Quantity, context);
                }
            }
            if (context.ShouldSerialize("quantityConceptModel")) {
                if ((_strong.QuantityConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("quantityConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.QuantityConceptKey);
                        if ((_delay != null)) {
                            _strong.QuantityConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("quantityConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                }
            }
            if (context.ShouldSerialize("quantityConcept")) {
                if ((_strong.QuantityConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConcept", _strong.QuantityConceptKey, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.ManufacturedMaterial _retVal = new SanteDB.Core.Model.Entities.ManufacturedMaterial();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("quantityConcept".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.QuantityConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("quantityConceptModel".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.QuantityConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("quantity".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantity", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.Quantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("isAdministrative".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isAdministrative", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.IsAdministrative = ((bool)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("formConcept".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.FormConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("formConceptModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.FormConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("expiryDate".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTime>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("expiryDate", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.ExpiryDate = ((System.Nullable<System.DateTime>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("lotNumber".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("lotNumber", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.LotNumber = ((string)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                if ((_type != typeof(SanteDB.Core.Model.Entities.ManufacturedMaterial))) {
                                                                                                                                                                                                    SanteDB.Core.Model.Entities.ManufacturedMaterial _nretVal = ((SanteDB.Core.Model.Entities.ManufacturedMaterial)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                    return _nretVal;
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                r.Skip();
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class MaterialViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(MaterialViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Material);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Material _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Material)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Material)));
            }
            if (context.ShouldSerialize("expiryDate")) {
                if ((_strong.ExpiryDate == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "expiryDate", _strong.ExpiryDate, context);
                }
            }
            if (context.ShouldSerialize("formConceptModel")) {
                if ((_strong.FormConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("formConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.FormConceptKey);
                        if ((_delay != null)) {
                            _strong.FormConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("formConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConceptModel", _strong.FormConcept, context);
                }
            }
            if (context.ShouldSerialize("formConcept")) {
                if ((_strong.FormConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "formConcept", _strong.FormConceptKey, context);
                }
            }
            if (context.ShouldSerialize("isAdministrative")) {
                if ((_strong.IsAdministrative == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isAdministrative", _strong.IsAdministrative, context);
                }
            }
            if (context.ShouldSerialize("quantity")) {
                if ((_strong.Quantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantity", _strong.Quantity, context);
                }
            }
            if (context.ShouldSerialize("quantityConceptModel")) {
                if ((_strong.QuantityConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("quantityConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.QuantityConceptKey);
                        if ((_delay != null)) {
                            _strong.QuantityConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("quantityConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConceptModel", _strong.QuantityConcept, context);
                }
            }
            if (context.ShouldSerialize("quantityConcept")) {
                if ((_strong.QuantityConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantityConcept", _strong.QuantityConceptKey, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Material _retVal = new SanteDB.Core.Model.Entities.Material();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("quantityConceptModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.QuantityConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("quantity".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantity", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.Quantity = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isAdministrative".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isAdministrative", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsAdministrative = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("formConceptModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.FormConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("expiryDate".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTime>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("expiryDate", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.ExpiryDate = ((System.Nullable<System.DateTime>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("quantityConcept".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantityConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.QuantityConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("formConcept".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("formConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.FormConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Entities.Material))) {
                                                                                                                                                                                                SanteDB.Core.Model.Entities.Material _nretVal = ((SanteDB.Core.Model.Entities.Material)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                return _nretVal;
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            r.Skip();
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class OrganizationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(OrganizationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Organization);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Organization _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Organization)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Organization)));
            }
            if (context.ShouldSerialize("industryConceptModel")) {
                if ((_strong.IndustryConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("industryConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.IndustryConceptKey);
                        if ((_delay != null)) {
                            _strong.IndustryConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "industryConceptModel", _strong.IndustryConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("industryConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "industryConceptModel", _strong.IndustryConcept, context);
                }
            }
            if (context.ShouldSerialize("industryConcept")) {
                if ((_strong.IndustryConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "industryConcept", _strong.IndustryConceptKey, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Organization _retVal = new SanteDB.Core.Model.Entities.Organization();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("industryConcept".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("industryConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.IndustryConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("industryConceptModel".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("industryConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.IndustryConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("$type".Equals(r.Value)) {
                                                                                                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                        if ((_type != typeof(SanteDB.Core.Model.Entities.Organization))) {
                                                                                                                                                                            SanteDB.Core.Model.Entities.Organization _nretVal = ((SanteDB.Core.Model.Entities.Organization)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                            return _nretVal;
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        r.Skip();
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PersonViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PersonViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Person);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Person _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Person)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Person)));
            }
            if (context.ShouldSerialize("dateOfBirthPrecision")) {
                if ((_strong.DateOfBirthPrecision == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirthPrecision", _strong.DateOfBirthPrecision, context);
                }
            }
            if (context.ShouldSerialize("dateOfBirth")) {
                if ((_strong.DateOfBirthXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dateOfBirth", _strong.DateOfBirthXml, context);
                }
            }
            if (context.ShouldSerialize("language")) {
                if (((_strong.LanguageCommunication == null) 
                            || (_strong.LanguageCommunication.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("language", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.PersonLanguageCommunication>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.LanguageCommunication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                        }
                        else {
                            context.RegisterMissTarget("language", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.LanguageCommunication, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Person _retVal = new SanteDB.Core.Model.Entities.Person();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("address".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("language".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.LanguageCommunication = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.PersonLanguageCommunication>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("dateOfBirth".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirth", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.DateOfBirthXml = ((string)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("dateOfBirthPrecision".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dateOfBirthPrecision", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.DateOfBirthPrecision = ((System.Nullable<SanteDB.Core.Model.DataTypes.DatePrecision>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Entities.Person))) {
                                                                                                                                                                                SanteDB.Core.Model.Entities.Person _nretVal = ((SanteDB.Core.Model.Entities.Person)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                return _nretVal;
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            r.Skip();
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PersonLanguageCommunicationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PersonLanguageCommunicationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.PersonLanguageCommunication);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.PersonLanguageCommunication _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.PersonLanguageCommunication)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.PersonLanguageCommunication)));
            }
            if (context.ShouldSerialize("isPreferred")) {
                if ((_strong.IsPreferred == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isPreferred", _strong.IsPreferred, context);
                }
            }
            if (context.ShouldSerialize("languageCode")) {
                if ((_strong.LanguageCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "languageCode", _strong.LanguageCode, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.PersonLanguageCommunication _retVal = new SanteDB.Core.Model.Entities.PersonLanguageCommunication();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("languageCode".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("languageCode", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.LanguageCode = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("isPreferred".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isPreferred", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.IsPreferred = ((bool)(_instance));
                                                }
                                            }
                                            else {
                                                if ("$type".Equals(r.Value)) {
                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                    if ((_type != typeof(SanteDB.Core.Model.Entities.PersonLanguageCommunication))) {
                                                        SanteDB.Core.Model.Entities.PersonLanguageCommunication _nretVal = ((SanteDB.Core.Model.Entities.PersonLanguageCommunication)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                        _nretVal.CopyObjectData(_retVal);
                                                        return _nretVal;
                                                    }
                                                }
                                                else {
                                                    r.Skip();
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PlaceViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PlaceViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.Place);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.Place _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.Place)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.Place)));
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("isMobile")) {
                if ((_strong.IsMobile == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isMobile", _strong.IsMobile, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("service")) {
                if (((_strong.Services == null) 
                            || (_strong.Services.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("service", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.PlaceService> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.PlaceService>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.PlaceService>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Services = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "service", _strong.Services, context);
                        }
                        else {
                            context.RegisterMissTarget("service", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "service", _strong.Services, context);
                }
            }
            if (context.ShouldSerialize("address")) {
                if (((_strong.Addresses == null) 
                            || (_strong.Addresses.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("address", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Addresses = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                        }
                        else {
                            context.RegisterMissTarget("address", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "address", _strong.Addresses, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("creationActModel")) {
                if ((_strong.CreationAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("creationActModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.CreationActKey);
                        if ((_delay != null)) {
                            _strong.CreationAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                        }
                        else {
                            context.RegisterMissTarget("creationActModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationActModel", _strong.CreationAct, context);
                }
            }
            if (context.ShouldSerialize("creationAct")) {
                if ((_strong.CreationActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationAct", _strong.CreationActKey, context);
                }
            }
            if (context.ShouldSerialize("determinerConceptModel")) {
                if ((_strong.DeterminerConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("determinerConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DeterminerConceptKey);
                        if ((_delay != null)) {
                            _strong.DeterminerConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("determinerConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConceptModel", _strong.DeterminerConcept, context);
                }
            }
            if (context.ShouldSerialize("determinerConcept")) {
                if ((_strong.DeterminerConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "determinerConcept", _strong.DeterminerConceptKey, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.Names == null) 
                            || (_strong.Names.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Names = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Names, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.EntityTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("telecom")) {
                if (((_strong.Telecoms == null) 
                            || (_strong.Telecoms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("telecom", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Entities.EntityTelecomAddress>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Telecoms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                        }
                        else {
                            context.RegisterMissTarget("telecom", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "telecom", _strong.Telecoms, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.Place _retVal = new SanteDB.Core.Model.Entities.Place();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("policy".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("typeConcept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("templateModel".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("template".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("telecom".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("telecom", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Telecoms = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityTelecomAddress>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("tag".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityTag>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConceptModel".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("relationship".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityRelationship>)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("participation".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("note".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityNote>)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("name".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.Names = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityName>)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("identifier".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityIdentifier>)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("extension".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.EntityExtension>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("determinerConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.DeterminerConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("determinerConceptModel".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("determinerConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.DeterminerConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("creationAct".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationAct", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.CreationActKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("creationActModel".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationActModel", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.CreationAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("classConceptModel".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("address".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("address", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.Addresses = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.EntityAddress>)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("service".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Entities.PlaceService>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("service", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.Services = ((System.Collections.Generic.List<SanteDB.Core.Model.Entities.PlaceService>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("geo".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("isMobile".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isMobile", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.IsMobile = ((bool)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("classConcept".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Entities.Place))) {
                                                                                                                                                                                SanteDB.Core.Model.Entities.Place _nretVal = ((SanteDB.Core.Model.Entities.Place)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                return _nretVal;
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            r.Skip();
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PlaceServiceViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PlaceServiceViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Entities.PlaceService);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Entities.PlaceService _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Entities.PlaceService)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Entities.PlaceService)));
            }
            if (context.ShouldSerialize("serviceConceptModel")) {
                if ((_strong.ServiceConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("serviceConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ServiceConceptKey);
                        if ((_delay != null)) {
                            _strong.ServiceConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "serviceConceptModel", _strong.ServiceConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("serviceConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "serviceConceptModel", _strong.ServiceConcept, context);
                }
            }
            if (context.ShouldSerialize("serviceConcept")) {
                if ((_strong.ServiceConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "serviceConcept", _strong.ServiceConceptKey, context);
                }
            }
            if (context.ShouldSerialize("serviceSchedule")) {
                if ((_strong.ServiceSchedule == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "serviceSchedule", _strong.ServiceSchedule, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Entities.PlaceService _retVal = new SanteDB.Core.Model.Entities.PlaceService();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("serviceSchedule".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(object), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("serviceSchedule", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ServiceSchedule = ((object)(_instance));
                                            }
                                        }
                                        else {
                                            if ("serviceConcept".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("serviceConcept", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ServiceConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("serviceConceptModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("serviceConceptModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.ServiceConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.Entities.PlaceService))) {
                                                            SanteDB.Core.Model.Entities.PlaceService _nretVal = ((SanteDB.Core.Model.Entities.PlaceService)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class AssigningAuthorityViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(AssigningAuthorityViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.AssigningAuthority);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.AssigningAuthority _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.AssigningAuthority)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.AssigningAuthority)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("domainName")) {
                if ((_strong.DomainName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "domainName", _strong.DomainName, context);
                }
            }
            if (context.ShouldSerialize("description")) {
                if ((_strong.Description == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "description", _strong.Description, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("url")) {
                if ((_strong.Url == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "url", _strong.Url, context);
                }
            }
            if (context.ShouldSerialize("scope")) {
                if (((_strong.AuthorityScopeXml == null) 
                            || (_strong.AuthorityScopeXml.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "scope", _strong.AuthorityScopeXml, context);
                }
            }
            if (context.ShouldSerialize("assigningApplication")) {
                if ((_strong.AssigningApplicationKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "assigningApplication", _strong.AssigningApplicationKey, context);
                }
            }
            if (context.ShouldSerialize("validation")) {
                if ((_strong.ValidationRegex == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "validation", _strong.ValidationRegex, context);
                }
            }
            if (context.ShouldSerialize("isUnique")) {
                if ((_strong.IsUnique == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isUnique", _strong.IsUnique, context);
                }
            }
            if (context.ShouldSerialize("assigningApplicationModel")) {
                if ((_strong.AssigningApplication == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("assigningApplicationModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Security.SecurityApplication _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Security.SecurityApplication>(_strong.AssigningApplicationKey);
                        if ((_delay != null)) {
                            _strong.AssigningApplication = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "assigningApplicationModel", _strong.AssigningApplication, context);
                        }
                        else {
                            context.RegisterMissTarget("assigningApplicationModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "assigningApplicationModel", _strong.AssigningApplication, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.AssigningAuthority _retVal = new SanteDB.Core.Model.DataTypes.AssigningAuthority();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("scopeModel".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.Concept>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("scopeModel", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.AuthorityScope = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.Concept>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("assigningApplicationModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityApplication), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("assigningApplicationModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.AssigningApplication = ((SanteDB.Core.Model.Security.SecurityApplication)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("isUnique".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isUnique", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.IsUnique = ((bool)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("validation".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("validation", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.ValidationRegex = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("assigningApplication".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("assigningApplication", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.AssigningApplicationKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("scope".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("scope", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.AuthorityScopeXml = ((System.Collections.Generic.List<System.Guid>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("url".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("url", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Url = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("oid".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Oid = ((string)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("description".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("description", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Description = ((string)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("domainName".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("domainName", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.DomainName = ((string)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("name".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Name = ((string)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("$type".Equals(r.Value)) {
                                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.AssigningAuthority))) {
                                                                                                            SanteDB.Core.Model.DataTypes.AssigningAuthority _nretVal = ((SanteDB.Core.Model.DataTypes.AssigningAuthority)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                                            return _nretVal;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        r.Skip();
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class CodeSystemViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(CodeSystemViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.CodeSystem);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.CodeSystem _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.CodeSystem)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.CodeSystem)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("authority")) {
                if ((_strong.Authority == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "authority", _strong.Authority, context);
                }
            }
            if (context.ShouldSerialize("obsoletionReason")) {
                if ((_strong.ObsoletionReason == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionReason", _strong.ObsoletionReason, context);
                }
            }
            if (context.ShouldSerialize("url")) {
                if ((_strong.Url == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "url", _strong.Url, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionText == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionText, context);
                }
            }
            if (context.ShouldSerialize("description")) {
                if ((_strong.Description == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "description", _strong.Description, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.CodeSystem _retVal = new SanteDB.Core.Model.DataTypes.CodeSystem();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("description".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("description", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Description = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("version".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.VersionText = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("url".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("url", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Url = ((string)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("obsoletionReason".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionReason", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.ObsoletionReason = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("authority".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("authority", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Authority = ((string)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("oid".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Oid = ((string)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("name".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Name = ((string)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                    if ((_type != typeof(SanteDB.Core.Model.DataTypes.CodeSystem))) {
                                                                                                        SanteDB.Core.Model.DataTypes.CodeSystem _nretVal = ((SanteDB.Core.Model.DataTypes.CodeSystem)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                        return _nretVal;
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    r.Skip();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.Concept);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.Concept _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.Concept)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.Concept)));
            }
            if (context.ShouldSerialize("isReadonly")) {
                if ((_strong.IsReadonly == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isReadonly", _strong.IsReadonly, context);
                }
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationship == null) 
                            || (_strong.Relationship.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ConceptRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationship = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationship, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationship, context);
                }
            }
            if (context.ShouldSerialize("conceptClass")) {
                if ((_strong.ClassKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "conceptClass", _strong.ClassKey, context);
                }
            }
            if (context.ShouldSerialize("conceptClassModel")) {
                if ((_strong.Class == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("conceptClassModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ConceptClass _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ConceptClass>(_strong.ClassKey);
                        if ((_delay != null)) {
                            _strong.Class = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "conceptClassModel", _strong.Class, context);
                        }
                        else {
                            context.RegisterMissTarget("conceptClassModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "conceptClassModel", _strong.Class, context);
                }
            }
            if (context.ShouldSerialize("referenceTerm")) {
                if (((_strong.ReferenceTerms == null) 
                            || (_strong.ReferenceTerms.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("referenceTerm", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptReferenceTerm> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptReferenceTerm>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ConceptReferenceTerm>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.ReferenceTerms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "referenceTerm", _strong.ReferenceTerms, context);
                        }
                        else {
                            context.RegisterMissTarget("referenceTerm", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "referenceTerm", _strong.ReferenceTerms, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.ConceptNames == null) 
                            || (_strong.ConceptNames.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ConceptName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.ConceptNames = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.ConceptNames, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.ConceptNames, context);
                }
            }
            if (context.ShouldSerialize("conceptSet")) {
                if (((_strong.ConceptSetsXml == null) 
                            || (_strong.ConceptSetsXml.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "conceptSet", _strong.ConceptSetsXml, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.Concept _retVal = new SanteDB.Core.Model.DataTypes.Concept();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("conceptSetModel".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptSet>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("conceptSetModel", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.ConceptSets = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptSet>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("conceptSet".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("conceptSet", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.ConceptSetsXml = ((System.Collections.Generic.List<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("name".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.ConceptNames = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptName>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("referenceTerm".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptReferenceTerm>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("referenceTerm", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.ReferenceTerms = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptReferenceTerm>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("conceptClassModel".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ConceptClass), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("conceptClassModel", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Class = ((SanteDB.Core.Model.DataTypes.ConceptClass)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("conceptClass".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("conceptClass", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.ClassKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("relationship".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Relationship = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ConceptRelationship>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("statusConceptModel".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("statusConcept".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("mnemonic".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.Mnemonic = ((string)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("isReadonly".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isReadonly", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.IsReadonly = ((bool)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.DataTypes.Concept))) {
                                                                                                                        SanteDB.Core.Model.DataTypes.Concept _nretVal = ((SanteDB.Core.Model.DataTypes.Concept)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                        return _nretVal;
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    r.Skip();
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptClassViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptClassViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptClass);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptClass _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptClass)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptClass)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptClass _retVal = new SanteDB.Core.Model.DataTypes.ConceptClass();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("mnemonic".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Mnemonic = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("name".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Name = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptClass))) {
                                                                                    SanteDB.Core.Model.DataTypes.ConceptClass _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptClass)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptNameViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptNameViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptName);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptName _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptName)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptName)));
            }
            if (context.ShouldSerialize("language")) {
                if ((_strong.Language == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.Language, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("phoneticCode")) {
                if ((_strong.PhoneticCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticCode", _strong.PhoneticCode, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithm")) {
                if ((_strong.PhoneticAlgorithmKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithm", _strong.PhoneticAlgorithmKey, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithmModel")) {
                if ((_strong.PhoneticAlgorithm == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("phoneticAlgorithmModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.PhoneticAlgorithm>(_strong.PhoneticAlgorithmKey);
                        if ((_delay != null)) {
                            _strong.PhoneticAlgorithm = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                        }
                        else {
                            context.RegisterMissTarget("phoneticAlgorithmModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptName _retVal = new SanteDB.Core.Model.DataTypes.ConceptName();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("phoneticAlgorithmModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithmModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.PhoneticAlgorithm = ((SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)(_instance));
                                            }
                                        }
                                        else {
                                            if ("phoneticAlgorithm".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithm", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.PhoneticAlgorithmKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("phoneticCode".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticCode", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.PhoneticCode = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("value".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.Name = ((string)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("language".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.Language = ((string)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("$type".Equals(r.Value)) {
                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptName))) {
                                                                    SanteDB.Core.Model.DataTypes.ConceptName _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptName)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                    _nretVal.CopyObjectData(_retVal);
                                                                    return _nretVal;
                                                                }
                                                            }
                                                            else {
                                                                r.Skip();
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.ConceptName _retVal = new SanteDB.Core.Model.DataTypes.ConceptName();
            _retVal.Name = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.ConceptName _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptName)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Name;
        }
    }
    
    public class ConceptReferenceTermViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptReferenceTermViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptReferenceTerm);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptReferenceTerm _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptReferenceTerm)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptReferenceTerm)));
            }
            if (context.ShouldSerialize("term")) {
                if ((_strong.ReferenceTermKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "term", _strong.ReferenceTermKey, context);
                }
            }
            if (context.ShouldSerialize("termModel")) {
                if ((_strong.ReferenceTerm == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("termModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ReferenceTerm _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ReferenceTerm>(_strong.ReferenceTermKey);
                        if ((_delay != null)) {
                            _strong.ReferenceTerm = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "termModel", _strong.ReferenceTerm, context);
                        }
                        else {
                            context.RegisterMissTarget("termModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "termModel", _strong.ReferenceTerm, context);
                }
            }
            if (context.ShouldSerialize("relationshipType")) {
                if ((_strong.RelationshipTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipType", _strong.RelationshipTypeKey, context);
                }
            }
            if (context.ShouldSerialize("relationshipTypeModel")) {
                if ((_strong.RelationshipType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationshipTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ConceptRelationshipType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ConceptRelationshipType>(_strong.RelationshipTypeKey);
                        if ((_delay != null)) {
                            _strong.RelationshipType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                        }
                        else {
                            context.RegisterMissTarget("relationshipTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptReferenceTerm _retVal = new SanteDB.Core.Model.DataTypes.ConceptReferenceTerm();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("relationshipTypeModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ConceptRelationshipType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipTypeModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.RelationshipType = ((SanteDB.Core.Model.DataTypes.ConceptRelationshipType)(_instance));
                                            }
                                        }
                                        else {
                                            if ("relationshipType".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipType", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.RelationshipTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("termModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ReferenceTerm), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("termModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.ReferenceTerm = ((SanteDB.Core.Model.DataTypes.ReferenceTerm)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("term".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("term", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ReferenceTermKey = ((System.Nullable<System.Guid>)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptReferenceTerm))) {
                                                                SanteDB.Core.Model.DataTypes.ConceptReferenceTerm _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptReferenceTerm)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptRelationshipViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptRelationshipViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptRelationship);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptRelationship _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptRelationship)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptRelationship)));
            }
            if (context.ShouldSerialize("targetConcept")) {
                if ((_strong.TargetConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetConcept", _strong.TargetConceptKey, context);
                }
            }
            if (context.ShouldSerialize("targetConceptModel")) {
                if ((_strong.TargetConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("targetConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TargetConceptKey);
                        if ((_delay != null)) {
                            _strong.TargetConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "targetConceptModel", _strong.TargetConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("targetConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetConceptModel", _strong.TargetConcept, context);
                }
            }
            if (context.ShouldSerialize("relationshipType")) {
                if ((_strong.RelationshipTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipType", _strong.RelationshipTypeKey, context);
                }
            }
            if (context.ShouldSerialize("relationshipTypeModel")) {
                if ((_strong.RelationshipType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationshipTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ConceptRelationshipType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ConceptRelationshipType>(_strong.RelationshipTypeKey);
                        if ((_delay != null)) {
                            _strong.RelationshipType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                        }
                        else {
                            context.RegisterMissTarget("relationshipTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptRelationship _retVal = new SanteDB.Core.Model.DataTypes.ConceptRelationship();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("relationshipTypeModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ConceptRelationshipType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipTypeModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.RelationshipType = ((SanteDB.Core.Model.DataTypes.ConceptRelationshipType)(_instance));
                                            }
                                        }
                                        else {
                                            if ("relationshipType".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipType", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.RelationshipTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("targetConceptModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetConceptModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.TargetConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("targetConcept".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetConcept", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.TargetConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptRelationship))) {
                                                                SanteDB.Core.Model.DataTypes.ConceptRelationship _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptRelationship)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptRelationshipTypeViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptRelationshipTypeViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptRelationshipType);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptRelationshipType _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptRelationshipType)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptRelationshipType)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptRelationshipType _retVal = new SanteDB.Core.Model.DataTypes.ConceptRelationshipType();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("mnemonic".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Mnemonic = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("name".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Name = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptRelationshipType))) {
                                                                                    SanteDB.Core.Model.DataTypes.ConceptRelationshipType _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptRelationshipType)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ConceptSetViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ConceptSetViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ConceptSet);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ConceptSet _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ConceptSet)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ConceptSet)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("url")) {
                if ((_strong.Url == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "url", _strong.Url, context);
                }
            }
            if (context.ShouldSerialize("concept")) {
                if (((_strong.ConceptsXml == null) 
                            || (_strong.ConceptsXml.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "concept", _strong.ConceptsXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionreasonModel")) {
                if ((_strong.ObsoletionReason == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionreasonModel", _strong.ObsoletionReason, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ConceptSet _retVal = new SanteDB.Core.Model.DataTypes.ConceptSet();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("obsoletionreasonModel".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionreasonModel", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.ObsoletionReason = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("concept".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("concept", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.ConceptsXml = ((System.Collections.Generic.List<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("url".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("url", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Url = ((string)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("oid".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Oid = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("mnemonic".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Mnemonic = ((string)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("name".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Name = ((string)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.ConceptSet))) {
                                                                                                    SanteDB.Core.Model.DataTypes.ConceptSet _nretVal = ((SanteDB.Core.Model.DataTypes.ConceptSet)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                    return _nretVal;
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                r.Skip();
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityExtensionViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityExtensionViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.EntityExtension);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.EntityExtension _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityExtension)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.EntityExtension)));
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.ExtensionValueXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.ExtensionValueXml, context);
                }
            }
            if (context.ShouldSerialize("valueModel")) {
                if ((_strong.ExtensionValueString == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueModel", _strong.ExtensionValueString, context);
                }
            }
            if (context.ShouldSerialize("extensionTypeModel")) {
                if ((_strong.ExtensionType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extensionTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ExtensionType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ExtensionType>(_strong.ExtensionTypeKey);
                        if ((_delay != null)) {
                            _strong.ExtensionType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extensionTypeModel", _strong.ExtensionType, context);
                        }
                        else {
                            context.RegisterMissTarget("extensionTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extensionTypeModel", _strong.ExtensionType, context);
                }
            }
            if (context.ShouldSerialize("extensionType")) {
                if ((_strong.ExtensionTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extensionType", _strong.ExtensionTypeKey, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.EntityExtension _retVal = new SanteDB.Core.Model.DataTypes.EntityExtension();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("extensionType".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extensionType", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ExtensionTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("extensionTypeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ExtensionType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extensionTypeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ExtensionType = ((SanteDB.Core.Model.DataTypes.ExtensionType)(_instance));
                                                }
                                            }
                                            else {
                                                if ("valueModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.ExtensionValueString = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("value".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(byte[]), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ExtensionValueXml = ((byte[])(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.EntityExtension))) {
                                                                SanteDB.Core.Model.DataTypes.EntityExtension _nretVal = ((SanteDB.Core.Model.DataTypes.EntityExtension)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityExtension _retVal = new SanteDB.Core.Model.DataTypes.EntityExtension();
            _retVal.ExtensionValueString = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityExtension _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityExtension)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.ExtensionValueString;
        }
    }
    
    public class ActExtensionViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActExtensionViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ActExtension);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ActExtension _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActExtension)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ActExtension)));
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.ExtensionValueXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.ExtensionValueXml, context);
                }
            }
            if (context.ShouldSerialize("valueModel")) {
                if ((_strong.ExtensionValueString == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueModel", _strong.ExtensionValueString, context);
                }
            }
            if (context.ShouldSerialize("extensionTypeModel")) {
                if ((_strong.ExtensionType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extensionTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.ExtensionType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.ExtensionType>(_strong.ExtensionTypeKey);
                        if ((_delay != null)) {
                            _strong.ExtensionType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extensionTypeModel", _strong.ExtensionType, context);
                        }
                        else {
                            context.RegisterMissTarget("extensionTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extensionTypeModel", _strong.ExtensionType, context);
                }
            }
            if (context.ShouldSerialize("extensionType")) {
                if ((_strong.ExtensionTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extensionType", _strong.ExtensionTypeKey, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ActExtension _retVal = new SanteDB.Core.Model.DataTypes.ActExtension();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("extensionType".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extensionType", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ExtensionTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("extensionTypeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.ExtensionType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extensionTypeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ExtensionType = ((SanteDB.Core.Model.DataTypes.ExtensionType)(_instance));
                                                }
                                            }
                                            else {
                                                if ("valueModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.ExtensionValueString = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("value".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(byte[]), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ExtensionValueXml = ((byte[])(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.ActExtension))) {
                                                                SanteDB.Core.Model.DataTypes.ActExtension _nretVal = ((SanteDB.Core.Model.DataTypes.ActExtension)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActExtension _retVal = new SanteDB.Core.Model.DataTypes.ActExtension();
            _retVal.ExtensionValueString = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActExtension _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActExtension)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.ExtensionValueString;
        }
    }
    
    public class ExtensionTypeViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ExtensionTypeViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ExtensionType);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ExtensionType _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ExtensionType)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ExtensionType)));
            }
            if (context.ShouldSerialize("handlerClass")) {
                if ((_strong.ExtensionHandlerXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "handlerClass", _strong.ExtensionHandlerXml, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ExtensionType _retVal = new SanteDB.Core.Model.DataTypes.ExtensionType();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("name".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Name = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("handlerClass".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("handlerClass", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.ExtensionHandlerXml = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.ExtensionType))) {
                                                                                    SanteDB.Core.Model.DataTypes.ExtensionType _nretVal = ((SanteDB.Core.Model.DataTypes.ExtensionType)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityIdentifierViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityIdentifierViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.EntityIdentifier);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.EntityIdentifier _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityIdentifier)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.EntityIdentifier)));
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("type")) {
                if ((_strong.IdentifierType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("type", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.IdentifierType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.IdentifierType>(_strong.IdentifierTypeKey);
                        if ((_delay != null)) {
                            _strong.IdentifierType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "type", _strong.IdentifierType, context);
                        }
                        else {
                            context.RegisterMissTarget("type", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "type", _strong.IdentifierType, context);
                }
            }
            if (context.ShouldSerialize("authority")) {
                if ((_strong.AuthorityXml == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("authority", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.AssigningAuthority _delay = null;
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "authority", _strong.AuthorityXml, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.EntityIdentifier _retVal = new SanteDB.Core.Model.DataTypes.EntityIdentifier();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("authority".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.AssigningAuthority), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("authority", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.AuthorityXml = ((SanteDB.Core.Model.DataTypes.AssigningAuthority)(_instance));
                                            }
                                        }
                                        else {
                                            if ("type".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.IdentifierType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("type", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.IdentifierType = ((SanteDB.Core.Model.DataTypes.IdentifierType)(_instance));
                                                }
                                            }
                                            else {
                                                if ("value".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Value = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.EntityIdentifier))) {
                                                            SanteDB.Core.Model.DataTypes.EntityIdentifier _nretVal = ((SanteDB.Core.Model.DataTypes.EntityIdentifier)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ActIdentifierViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActIdentifierViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ActIdentifier);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ActIdentifier _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActIdentifier)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ActIdentifier)));
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("type")) {
                if ((_strong.IdentifierType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("type", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.IdentifierType _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.IdentifierType>(_strong.IdentifierTypeKey);
                        if ((_delay != null)) {
                            _strong.IdentifierType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "type", _strong.IdentifierType, context);
                        }
                        else {
                            context.RegisterMissTarget("type", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "type", _strong.IdentifierType, context);
                }
            }
            if (context.ShouldSerialize("authority")) {
                if ((_strong.AuthorityXml == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("authority", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.AssigningAuthority _delay = null;
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "authority", _strong.AuthorityXml, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ActIdentifier _retVal = new SanteDB.Core.Model.DataTypes.ActIdentifier();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("authority".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.AssigningAuthority), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("authority", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.AuthorityXml = ((SanteDB.Core.Model.DataTypes.AssigningAuthority)(_instance));
                                            }
                                        }
                                        else {
                                            if ("type".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.IdentifierType), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("type", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.IdentifierType = ((SanteDB.Core.Model.DataTypes.IdentifierType)(_instance));
                                                }
                                            }
                                            else {
                                                if ("value".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Value = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.ActIdentifier))) {
                                                            SanteDB.Core.Model.DataTypes.ActIdentifier _nretVal = ((SanteDB.Core.Model.DataTypes.ActIdentifier)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class IdentifierTypeViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(IdentifierTypeViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.IdentifierType);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.IdentifierType _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.IdentifierType)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.IdentifierType)));
            }
            if (context.ShouldSerialize("scopeConcept")) {
                if ((_strong.ScopeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "scopeConcept", _strong.ScopeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("scopeConceptModel")) {
                if ((_strong.ScopeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("scopeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ScopeConceptKey);
                        if ((_delay != null)) {
                            _strong.ScopeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "scopeConceptModel", _strong.ScopeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("scopeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "scopeConceptModel", _strong.ScopeConcept, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.IdentifierType _retVal = new SanteDB.Core.Model.DataTypes.IdentifierType();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("scopeConceptModel".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("scopeConceptModel", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.ScopeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("typeConceptModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("typeConcept".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("scopeConcept".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("scopeConcept", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.ScopeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("$type".Equals(r.Value)) {
                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.IdentifierType))) {
                                                                                SanteDB.Core.Model.DataTypes.IdentifierType _nretVal = ((SanteDB.Core.Model.DataTypes.IdentifierType)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                return _nretVal;
                                                                            }
                                                                        }
                                                                        else {
                                                                            r.Skip();
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class EntityNoteViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityNoteViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.EntityNote);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.EntityNote _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityNote)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.EntityNote)));
            }
            if (context.ShouldSerialize("text")) {
                if ((_strong.Text == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "text", _strong.Text, context);
                }
            }
            if (context.ShouldSerialize("author")) {
                if ((_strong.AuthorKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "author", _strong.AuthorKey, context);
                }
            }
            if (context.ShouldSerialize("authorModel")) {
                if ((_strong.Author == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("authorModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Entities.Entity _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Entities.Entity>(_strong.AuthorKey);
                        if ((_delay != null)) {
                            _strong.Author = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "authorModel", _strong.Author, context);
                        }
                        else {
                            context.RegisterMissTarget("authorModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "authorModel", _strong.Author, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.EntityNote _retVal = new SanteDB.Core.Model.DataTypes.EntityNote();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("authorModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("authorModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Author = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                            }
                                        }
                                        else {
                                            if ("author".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("author", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.AuthorKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("text".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("text", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Text = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.EntityNote))) {
                                                            SanteDB.Core.Model.DataTypes.EntityNote _nretVal = ((SanteDB.Core.Model.DataTypes.EntityNote)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityNote _retVal = new SanteDB.Core.Model.DataTypes.EntityNote();
            _retVal.Text = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityNote _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityNote)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Text;
        }
    }
    
    public class ActNoteViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActNoteViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ActNote);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ActNote _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActNote)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ActNote)));
            }
            if (context.ShouldSerialize("text")) {
                if ((_strong.Text == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "text", _strong.Text, context);
                }
            }
            if (context.ShouldSerialize("author")) {
                if ((_strong.AuthorKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "author", _strong.AuthorKey, context);
                }
            }
            if (context.ShouldSerialize("authorModel")) {
                if ((_strong.Author == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("authorModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Entities.Entity _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Entities.Entity>(_strong.AuthorKey);
                        if ((_delay != null)) {
                            _strong.Author = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "authorModel", _strong.Author, context);
                        }
                        else {
                            context.RegisterMissTarget("authorModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "authorModel", _strong.Author, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ActNote _retVal = new SanteDB.Core.Model.DataTypes.ActNote();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("authorModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("authorModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Author = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                            }
                                        }
                                        else {
                                            if ("author".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("author", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.AuthorKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("text".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("text", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.Text = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("$type".Equals(r.Value)) {
                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.ActNote))) {
                                                            SanteDB.Core.Model.DataTypes.ActNote _nretVal = ((SanteDB.Core.Model.DataTypes.ActNote)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                            _nretVal.CopyObjectData(_retVal);
                                                            return _nretVal;
                                                        }
                                                    }
                                                    else {
                                                        r.Skip();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActNote _retVal = new SanteDB.Core.Model.DataTypes.ActNote();
            _retVal.Text = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActNote _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActNote)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Text;
        }
    }
    
    public class PhoneticAlgorithmViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PhoneticAlgorithmViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("handler")) {
                if ((_strong.Handler == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "handler", _strong.Handler, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _retVal = new SanteDB.Core.Model.DataTypes.PhoneticAlgorithm();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("handler".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("handler", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Handler = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("name".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Name = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("$type".Equals(r.Value)) {
                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                if ((_type != typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm))) {
                                                                                    SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _nretVal = ((SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                    return _nretVal;
                                                                                }
                                                                            }
                                                                            else {
                                                                                r.Skip();
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ReferenceTermViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ReferenceTermViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ReferenceTerm);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ReferenceTerm _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ReferenceTerm)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ReferenceTerm)));
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("codeSystemModel")) {
                if ((_strong.CodeSystem == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("codeSystemModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.CodeSystem _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.CodeSystem>(_strong.CodeSystemKey);
                        if ((_delay != null)) {
                            _strong.CodeSystem = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "codeSystemModel", _strong.CodeSystem, context);
                        }
                        else {
                            context.RegisterMissTarget("codeSystemModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "codeSystemModel", _strong.CodeSystem, context);
                }
            }
            if (context.ShouldSerialize("codeSystem")) {
                if ((_strong.CodeSystemKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "codeSystem", _strong.CodeSystemKey, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if (((_strong.DisplayNames == null) 
                            || (_strong.DisplayNames.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("name", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ReferenceTermName> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ReferenceTermName>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ReferenceTermName>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.DisplayNames = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "name", _strong.DisplayNames, context);
                        }
                        else {
                            context.RegisterMissTarget("name", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.DisplayNames, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ReferenceTerm _retVal = new SanteDB.Core.Model.DataTypes.ReferenceTerm();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("name".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ReferenceTermName>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.DisplayNames = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ReferenceTermName>)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("codeSystem".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("codeSystem", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.CodeSystemKey = ((System.Nullable<System.Guid>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("codeSystemModel".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.CodeSystem), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("codeSystemModel", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.CodeSystem = ((SanteDB.Core.Model.DataTypes.CodeSystem)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("mnemonic".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Mnemonic = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("$type".Equals(r.Value)) {
                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.ReferenceTerm))) {
                                                                                            SanteDB.Core.Model.DataTypes.ReferenceTerm _nretVal = ((SanteDB.Core.Model.DataTypes.ReferenceTerm)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                            return _nretVal;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        r.Skip();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ReferenceTermNameViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ReferenceTermNameViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ReferenceTermName);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ReferenceTermName _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ReferenceTermName)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ReferenceTermName)));
            }
            if (context.ShouldSerialize("language")) {
                if ((_strong.Language == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "language", _strong.Language, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("phoneticCode")) {
                if ((_strong.PhoneticCode == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticCode", _strong.PhoneticCode, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithm")) {
                if ((_strong.PhoneticAlgorithmKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithm", _strong.PhoneticAlgorithmKey, context);
                }
            }
            if (context.ShouldSerialize("phoneticAlgorithmModel")) {
                if ((_strong.PhoneticAlgorithm == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("phoneticAlgorithmModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.PhoneticAlgorithm _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.PhoneticAlgorithm>(_strong.PhoneticAlgorithmKey);
                        if ((_delay != null)) {
                            _strong.PhoneticAlgorithm = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                        }
                        else {
                            context.RegisterMissTarget("phoneticAlgorithmModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "phoneticAlgorithmModel", _strong.PhoneticAlgorithm, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ReferenceTermName _retVal = new SanteDB.Core.Model.DataTypes.ReferenceTermName();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("source".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("phoneticAlgorithmModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.PhoneticAlgorithm), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithmModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.PhoneticAlgorithm = ((SanteDB.Core.Model.DataTypes.PhoneticAlgorithm)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("phoneticAlgorithm".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticAlgorithm", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PhoneticAlgorithmKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("phoneticCode".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("phoneticCode", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.PhoneticCode = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("value".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Name = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("language".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("language", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Language = ((string)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("$type".Equals(r.Value)) {
                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                    if ((_type != typeof(SanteDB.Core.Model.DataTypes.ReferenceTermName))) {
                                                                                        SanteDB.Core.Model.DataTypes.ReferenceTermName _nretVal = ((SanteDB.Core.Model.DataTypes.ReferenceTermName)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                        return _nretVal;
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    r.Skip();
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.ReferenceTermName _retVal = new SanteDB.Core.Model.DataTypes.ReferenceTermName();
            _retVal.Name = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.ReferenceTermName _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ReferenceTermName)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Name;
        }
    }
    
    public class EntityTagViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(EntityTagViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.EntityTag);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.EntityTag _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityTag)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.EntityTag)));
            }
            if (context.ShouldSerialize("key")) {
                if ((_strong.TagKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "key", _strong.TagKey, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.EntityTag _retVal = new SanteDB.Core.Model.DataTypes.EntityTag();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sourceModel".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.SourceEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("source".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("value".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.Value = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("key".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("key", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.TagKey = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("$type".Equals(r.Value)) {
                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.EntityTag))) {
                                                                                SanteDB.Core.Model.DataTypes.EntityTag _nretVal = ((SanteDB.Core.Model.DataTypes.EntityTag)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                return _nretVal;
                                                                            }
                                                                        }
                                                                        else {
                                                                            r.Skip();
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityTag _retVal = new SanteDB.Core.Model.DataTypes.EntityTag();
            _retVal.Value = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.EntityTag _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.EntityTag)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Value;
        }
    }
    
    public class ActTagViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActTagViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.ActTag);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.ActTag _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActTag)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.ActTag)));
            }
            if (context.ShouldSerialize("key")) {
                if ((_strong.TagKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "key", _strong.TagKey, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.ActTag _retVal = new SanteDB.Core.Model.DataTypes.ActTag();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sourceModel".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("source".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("value".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.Value = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("key".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("key", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.TagKey = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("$type".Equals(r.Value)) {
                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                            if ((_type != typeof(SanteDB.Core.Model.DataTypes.ActTag))) {
                                                                                SanteDB.Core.Model.DataTypes.ActTag _nretVal = ((SanteDB.Core.Model.DataTypes.ActTag)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                return _nretVal;
                                                                            }
                                                                        }
                                                                        else {
                                                                            r.Skip();
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            string _strong = null;
            if ((o == null)) {
                return null;
            }
            try {
                _strong = o.ToString();
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActTag _retVal = new SanteDB.Core.Model.DataTypes.ActTag();
            _retVal.Value = _strong;
            return _retVal;
        }
        
        public object GetSimpleValue(object o) {
            if ((o == null)) {
                return null;
            }
            SanteDB.Core.Model.DataTypes.ActTag _strong = null;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.ActTag)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                return null;
            }
            return _strong.Value;
        }
    }
    
    public class TemplateDefinitionViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(TemplateDefinitionViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.DataTypes.TemplateDefinition _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition)));
            }
            if (context.ShouldSerialize("mnemonic")) {
                if ((_strong.Mnemonic == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "mnemonic", _strong.Mnemonic, context);
                }
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("description")) {
                if ((_strong.Description == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "description", _strong.Description, context);
                }
            }
            if (context.ShouldSerialize("updatedTime")) {
                if ((_strong.UpdatedTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedTime", _strong.UpdatedTimeXml, context);
                }
            }
            if (context.ShouldSerialize("updatedBy")) {
                if ((_strong.UpdatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "updatedBy", _strong.UpdatedByKey, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.DataTypes.TemplateDefinition _retVal = new SanteDB.Core.Model.DataTypes.TemplateDefinition();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("updatedBy".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedBy", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.UpdatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("updatedByModel".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedByModel", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.UpdatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("updatedTime".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("updatedTime", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.UpdatedTimeXml = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("description".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("description", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.Description = ((string)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("oid".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Oid = ((string)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("name".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Name = ((string)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("mnemonic".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("mnemonic", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Mnemonic = ((string)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("$type".Equals(r.Value)) {
                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                        if ((_type != typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition))) {
                                                                                            SanteDB.Core.Model.DataTypes.TemplateDefinition _nretVal = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                            return _nretVal;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        r.Skip();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class BundleViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(BundleViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Collection.Bundle);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Collection.Bundle _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Collection.Bundle)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Collection.Bundle)));
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("item")) {
                if (((_strong.Item == null) 
                            || (_strong.Item.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("item", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.IdentifiedData> _delay = null;
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "item", _strong.Item, context);
                }
            }
            if (context.ShouldSerialize("entry")) {
                if ((_strong.EntryKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "entry", _strong.EntryKey, context);
                }
            }
            if (context.ShouldSerialize("offset")) {
                if ((_strong.Offset == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "offset", _strong.Offset, context);
                }
            }
            if (context.ShouldSerialize("count")) {
                if ((_strong.Count == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "count", _strong.Count, context);
                }
            }
            if (context.ShouldSerialize("totalResults")) {
                if ((_strong.TotalResults == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "totalResults", _strong.TotalResults, context);
                }
            }
            if (context.ShouldSerialize("refItem")) {
                if (((_strong.ExpansionKeys == null) 
                            || (_strong.ExpansionKeys.Count == 0))) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "refItem", _strong.ExpansionKeys, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Collection.Bundle _retVal = new SanteDB.Core.Model.Collection.Bundle();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("refItem".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("refItem", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ExpansionKeys = ((System.Collections.Generic.List<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("totalResults".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("totalResults", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.TotalResults = ((int)(_instance));
                                }
                            }
                            else {
                                if ("count".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("count", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.Count = ((int)(_instance));
                                    }
                                }
                                else {
                                    if ("offset".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("offset", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.Offset = ((int)(_instance));
                                        }
                                    }
                                    else {
                                        if ("entry".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("entry", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.EntryKey = ((System.Nullable<System.Guid>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("item".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.IdentifiedData>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("item", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.Item = ((System.Collections.Generic.List<SanteDB.Core.Model.IdentifiedData>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("$type".Equals(r.Value)) {
                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                    if ((_type != typeof(SanteDB.Core.Model.Collection.Bundle))) {
                                                        SanteDB.Core.Model.Collection.Bundle _nretVal = ((SanteDB.Core.Model.Collection.Bundle)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                        _nretVal.CopyObjectData(_retVal);
                                                        return _nretVal;
                                                    }
                                                }
                                                else {
                                                    r.Skip();
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class AccountViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(AccountViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.Account);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.Account _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.Account)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.Account)));
            }
            if (context.ShouldSerialize("balance")) {
                if ((_strong.Balance == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "balance", _strong.Balance, context);
                }
            }
            if (context.ShouldSerialize("currency")) {
                if ((_strong.CurrencyKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currency", _strong.CurrencyKey, context);
                }
            }
            if (context.ShouldSerialize("currencyModel")) {
                if ((_strong.Currency == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("currencyModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.CurrencyKey);
                        if ((_delay != null)) {
                            _strong.Currency = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                        }
                        else {
                            context.RegisterMissTarget("currencyModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                }
            }
            if (context.ShouldSerialize("minBalance")) {
                if ((_strong.MinBalance == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "minBalance", _strong.MinBalance, context);
                }
            }
            if (context.ShouldSerialize("maxBalance")) {
                if ((_strong.MaxBalance == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "maxBalance", _strong.MaxBalance, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.Account _retVal = new SanteDB.Core.Model.Acts.Account();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("maxBalance".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("maxBalance", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.MaxBalance = ((decimal)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("minBalance".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<decimal>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("minBalance", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.MinBalance = ((System.Nullable<decimal>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("currencyModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currencyModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.Currency = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("currency".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currency", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.CurrencyKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("balance".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("balance", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.Balance = ((decimal)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                if ((_type != typeof(SanteDB.Core.Model.Acts.Account))) {
                                                                                                                                                                                                    SanteDB.Core.Model.Acts.Account _nretVal = ((SanteDB.Core.Model.Acts.Account)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                    return _nretVal;
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                r.Skip();
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ActViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.Act);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.Act _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.Act)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.Act)));
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.Act _retVal = new SanteDB.Core.Model.Acts.Act();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("stopTime".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("startTime".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("actTime".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("templateModel".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("isNegated".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("typeConcept".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("statusConcept".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("moodConcept".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("classConcept".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("template".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.Act))) {
                                                                                                                                                                                SanteDB.Core.Model.Acts.Act _nretVal = ((SanteDB.Core.Model.Acts.Act)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                return _nretVal;
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            r.Skip();
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ActParticipationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActParticipationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.ActParticipation);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.ActParticipation _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.ActParticipation)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.ActParticipation)));
            }
            if (context.ShouldSerialize("player")) {
                if ((_strong.PlayerEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "player", _strong.PlayerEntityKey, context);
                }
            }
            if (context.ShouldSerialize("participationRole")) {
                if ((_strong.ParticipationRoleKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participationRole", _strong.ParticipationRoleKey, context);
                }
            }
            if (context.ShouldSerialize("playerModel")) {
                if ((_strong.PlayerEntity == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("playerModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Entities.Entity _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Entities.Entity>(_strong.PlayerEntityKey);
                        if ((_delay != null)) {
                            _strong.PlayerEntity = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "playerModel", _strong.PlayerEntity, context);
                        }
                        else {
                            context.RegisterMissTarget("playerModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "playerModel", _strong.PlayerEntity, context);
                }
            }
            if (context.ShouldSerialize("participationRoleModel")) {
                if ((_strong.ParticipationRole == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participationRoleModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ParticipationRoleKey);
                        if ((_delay != null)) {
                            _strong.ParticipationRole = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participationRoleModel", _strong.ParticipationRole, context);
                        }
                        else {
                            context.RegisterMissTarget("participationRoleModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participationRoleModel", _strong.ParticipationRole, context);
                }
            }
            if (context.ShouldSerialize("act")) {
                if ((_strong.ActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "act", _strong.ActKey, context);
                }
            }
            if (context.ShouldSerialize("quantity")) {
                if ((_strong.Quantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "quantity", _strong.Quantity, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.ActParticipation _retVal = new SanteDB.Core.Model.Acts.ActParticipation();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("quantity".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("quantity", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Quantity = ((System.Nullable<int>)(_instance));
                                            }
                                        }
                                        else {
                                            if ("actModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.Act = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                }
                                            }
                                            else {
                                                if ("act".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("act", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.ActKey = ((System.Nullable<System.Guid>)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("participationRoleModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participationRoleModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.ParticipationRole = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("playerModel".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Entities.Entity), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("playerModel", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.PlayerEntity = ((SanteDB.Core.Model.Entities.Entity)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("participationRole".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participationRole", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.ParticipationRoleKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("player".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("player", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PlayerEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("$type".Equals(r.Value)) {
                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                        if ((_type != typeof(SanteDB.Core.Model.Acts.ActParticipation))) {
                                                                            SanteDB.Core.Model.Acts.ActParticipation _nretVal = ((SanteDB.Core.Model.Acts.ActParticipation)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                            _nretVal.CopyObjectData(_retVal);
                                                                            return _nretVal;
                                                                        }
                                                                    }
                                                                    else {
                                                                        r.Skip();
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ActProtocolViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActProtocolViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.ActProtocol);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.ActProtocol _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.ActProtocol)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.ActProtocol)));
            }
            if (context.ShouldSerialize("protocol")) {
                if ((_strong.ProtocolKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.ProtocolKey, context);
                }
            }
            if (context.ShouldSerialize("protocolModel")) {
                if ((_strong.Protocol == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocolModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Protocol _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Protocol>(_strong.ProtocolKey);
                        if ((_delay != null)) {
                            _strong.Protocol = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocolModel", _strong.Protocol, context);
                        }
                        else {
                            context.RegisterMissTarget("protocolModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocolModel", _strong.Protocol, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.Sequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.Sequence, context);
                }
            }
            if (context.ShouldSerialize("state")) {
                if ((_strong.StateData == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "state", _strong.StateData, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.ActProtocol _retVal = new SanteDB.Core.Model.Acts.ActProtocol();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("state".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(byte[]), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("state", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.StateData = ((byte[])(_instance));
                                    }
                                }
                                else {
                                    if ("sequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.Sequence = ((int)(_instance));
                                        }
                                    }
                                    else {
                                        if ("protocolModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Protocol), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocolModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.Protocol = ((SanteDB.Core.Model.Acts.Protocol)(_instance));
                                            }
                                        }
                                        else {
                                            if ("protocol".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Guid), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ProtocolKey = ((System.Guid)(_instance));
                                                }
                                            }
                                            else {
                                                if ("$type".Equals(r.Value)) {
                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.ActProtocol))) {
                                                        SanteDB.Core.Model.Acts.ActProtocol _nretVal = ((SanteDB.Core.Model.Acts.ActProtocol)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                        _nretVal.CopyObjectData(_retVal);
                                                        return _nretVal;
                                                    }
                                                }
                                                else {
                                                    r.Skip();
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ActRelationshipViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ActRelationshipViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.ActRelationship);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.ActRelationship _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.ActRelationship)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.ActRelationship)));
            }
            if (context.ShouldSerialize("target")) {
                if ((_strong.TargetActKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "target", _strong.TargetActKey, context);
                }
            }
            if (context.ShouldSerialize("targetModel")) {
                if ((_strong.TargetAct == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("targetModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.Acts.Act _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.Acts.Act>(_strong.TargetActKey);
                        if ((_delay != null)) {
                            _strong.TargetAct = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "targetModel", _strong.TargetAct, context);
                        }
                        else {
                            context.RegisterMissTarget("targetModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetModel", _strong.TargetAct, context);
                }
            }
            if (context.ShouldSerialize("relationshipType")) {
                if ((_strong.RelationshipTypeKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipType", _strong.RelationshipTypeKey, context);
                }
            }
            if (context.ShouldSerialize("relationshipTypeModel")) {
                if ((_strong.RelationshipType == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationshipTypeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.RelationshipTypeKey);
                        if ((_delay != null)) {
                            _strong.RelationshipType = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                        }
                        else {
                            context.RegisterMissTarget("relationshipTypeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationshipTypeModel", _strong.RelationshipType, context);
                }
            }
            if (context.ShouldSerialize("effectiveVersionSequence")) {
                if ((_strong.EffectiveVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "effectiveVersionSequence", _strong.EffectiveVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("obsoleteVersionSequence")) {
                if ((_strong.ObsoleteVersionSequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoleteVersionSequence", _strong.ObsoleteVersionSequenceId, context);
                }
            }
            if (context.ShouldSerialize("modifiedOn")) {
                if ((_strong.ModifiedOn == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifiedOn", _strong.ModifiedOn, context);
                }
            }
            if (context.ShouldSerialize("source")) {
                if ((_strong.SourceEntityKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "source", _strong.SourceEntityKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.ActRelationship _retVal = new SanteDB.Core.Model.Acts.ActRelationship();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("sourceModel".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sourceModel", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.SourceEntity = ((SanteDB.Core.Model.Acts.Act)(_instance));
                            }
                        }
                        else {
                            if ("source".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("source", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.SourceEntityKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoleteVersionSequence".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoleteVersionSequence", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoleteVersionSequenceId = ((System.Nullable<int>)(_instance));
                                    }
                                }
                                else {
                                    if ("effectiveVersionSequence".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("effectiveVersionSequence", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.EffectiveVersionSequenceId = ((System.Nullable<int>)(_instance));
                                        }
                                    }
                                    else {
                                        if ("relationshipTypeModel".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipTypeModel", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.RelationshipType = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                            }
                                        }
                                        else {
                                            if ("relationshipType".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationshipType", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.RelationshipTypeKey = ((System.Nullable<System.Guid>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("targetModel".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Acts.Act), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetModel", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.TargetAct = ((SanteDB.Core.Model.Acts.Act)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("target".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("target", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.TargetActKey = ((System.Nullable<System.Guid>)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("$type".Equals(r.Value)) {
                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.ActRelationship))) {
                                                                SanteDB.Core.Model.Acts.ActRelationship _nretVal = ((SanteDB.Core.Model.Acts.ActRelationship)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                _nretVal.CopyObjectData(_retVal);
                                                                return _nretVal;
                                                            }
                                                        }
                                                        else {
                                                            r.Skip();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class CarePlanViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(CarePlanViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.CarePlan);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.CarePlan _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.CarePlan)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.CarePlan)));
            }
            if (context.ShouldSerialize("target")) {
                if ((_strong.Target == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("target", _strong.Key.Value))) {
                        SanteDB.Core.Model.Roles.Patient _delay = null;
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "target", _strong.Target, context);
                }
            }
            if (context.ShouldSerialize("act")) {
                if (((_strong.Action == null) 
                            || (_strong.Action.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("act", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.Act> _delay = null;
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "act", _strong.Action, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.CarePlan _retVal = new SanteDB.Core.Model.Acts.CarePlan();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("act".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.Act>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("act", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.Action = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.Act>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("target".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Roles.Patient), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("target", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.Target = ((SanteDB.Core.Model.Roles.Patient)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("$type".Equals(r.Value)) {
                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.CarePlan))) {
                                                                        SanteDB.Core.Model.Acts.CarePlan _nretVal = ((SanteDB.Core.Model.Acts.CarePlan)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                        _nretVal.CopyObjectData(_retVal);
                                                                        return _nretVal;
                                                                    }
                                                                }
                                                                else {
                                                                    r.Skip();
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ControlActViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ControlActViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.ControlAct);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.ControlAct _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.ControlAct)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.ControlAct)));
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.ControlAct _retVal = new SanteDB.Core.Model.Acts.ControlAct();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.ControlAct))) {
                                                                                                                                                                                SanteDB.Core.Model.Acts.ControlAct _nretVal = ((SanteDB.Core.Model.Acts.ControlAct)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                return _nretVal;
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            r.Skip();
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class FinancialContractViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(FinancialContractViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.FinancialContract);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.FinancialContract _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.FinancialContract)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.FinancialContract)));
            }
            if (context.ShouldSerialize("paymentTerms")) {
                if ((_strong.PaymentTermsKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "paymentTerms", _strong.PaymentTermsKey, context);
                }
            }
            if (context.ShouldSerialize("paymentTermsModel")) {
                if ((_strong.PaymentTerms == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("paymentTermsModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.PaymentTermsKey);
                        if ((_delay != null)) {
                            _strong.PaymentTerms = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "paymentTermsModel", _strong.PaymentTerms, context);
                        }
                        else {
                            context.RegisterMissTarget("paymentTermsModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "paymentTermsModel", _strong.PaymentTerms, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.FinancialContract _retVal = new SanteDB.Core.Model.Acts.FinancialContract();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("paymentTermsModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("paymentTermsModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.PaymentTerms = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("paymentTerms".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("paymentTerms", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.PaymentTermsKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.FinancialContract))) {
                                                                                                                                                                                        SanteDB.Core.Model.Acts.FinancialContract _nretVal = ((SanteDB.Core.Model.Acts.FinancialContract)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class FinancialTransactionViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(FinancialTransactionViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.FinancialTransaction);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.FinancialTransaction _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.FinancialTransaction)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.FinancialTransaction)));
            }
            if (context.ShouldSerialize("amount")) {
                if ((_strong.Amount == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "amount", _strong.Amount, context);
                }
            }
            if (context.ShouldSerialize("currency")) {
                if ((_strong.CurrencyKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currency", _strong.CurrencyKey, context);
                }
            }
            if (context.ShouldSerialize("currencyModel")) {
                if ((_strong.Currency == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("currencyModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.CurrencyKey);
                        if ((_delay != null)) {
                            _strong.Currency = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                        }
                        else {
                            context.RegisterMissTarget("currencyModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                }
            }
            if (context.ShouldSerialize("creditExchange")) {
                if ((_strong.CreditExchangeRate == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creditExchange", _strong.CreditExchangeRate, context);
                }
            }
            if (context.ShouldSerialize("debitExchange")) {
                if ((_strong.DebitExchangeRate == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "debitExchange", _strong.DebitExchangeRate, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.FinancialTransaction _retVal = new SanteDB.Core.Model.Acts.FinancialTransaction();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("debitExchange".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(float), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("debitExchange", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.DebitExchangeRate = ((float)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("creditExchange".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(float), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creditExchange", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.CreditExchangeRate = ((float)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("currencyModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currencyModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.Currency = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("currency".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currency", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.CurrencyKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("amount".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("amount", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.Amount = ((decimal)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                if ((_type != typeof(SanteDB.Core.Model.Acts.FinancialTransaction))) {
                                                                                                                                                                                                    SanteDB.Core.Model.Acts.FinancialTransaction _nretVal = ((SanteDB.Core.Model.Acts.FinancialTransaction)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                    return _nretVal;
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                r.Skip();
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class InvoiceElementViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(InvoiceElementViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.InvoiceElement);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.InvoiceElement _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.InvoiceElement)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.InvoiceElement)));
            }
            if (context.ShouldSerialize("modifier")) {
                if ((_strong.ModifierKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifier", _strong.ModifierKey, context);
                }
            }
            if (context.ShouldSerialize("modifierModel")) {
                if ((_strong.Modifier == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("modifierModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ModifierKey);
                        if ((_delay != null)) {
                            _strong.Modifier = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "modifierModel", _strong.Modifier, context);
                        }
                        else {
                            context.RegisterMissTarget("modifierModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "modifierModel", _strong.Modifier, context);
                }
            }
            if (context.ShouldSerialize("unitQty")) {
                if ((_strong.UnitQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "unitQty", _strong.UnitQuantity, context);
                }
            }
            if (context.ShouldSerialize("unitPrice")) {
                if ((_strong.UnitPrice == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "unitPrice", _strong.UnitPrice, context);
                }
            }
            if (context.ShouldSerialize("netPrice")) {
                if ((_strong.NetPrice == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "netPrice", _strong.NetPrice, context);
                }
            }
            if (context.ShouldSerialize("currency")) {
                if ((_strong.CurrencyKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currency", _strong.CurrencyKey, context);
                }
            }
            if (context.ShouldSerialize("currencyModel")) {
                if ((_strong.Currency == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("currencyModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.CurrencyKey);
                        if ((_delay != null)) {
                            _strong.Currency = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                        }
                        else {
                            context.RegisterMissTarget("currencyModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "currencyModel", _strong.Currency, context);
                }
            }
            if (context.ShouldSerialize("factor")) {
                if ((_strong.Factor == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "factor", _strong.Factor, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.InvoiceElement _retVal = new SanteDB.Core.Model.Acts.InvoiceElement();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("factor".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<float>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("factor", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.Factor = ((System.Nullable<float>)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("currencyModel".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currencyModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.Currency = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("currency".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("currency", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.CurrencyKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("netPrice".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("netPrice", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.NetPrice = ((decimal)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("unitPrice".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("unitPrice", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.UnitPrice = ((decimal)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("unitQty".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("unitQty", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.UnitQuantity = ((decimal)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("modifierModel".Equals(r.Value)) {
                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("modifierModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                        _retVal.Modifier = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    if ("modifier".Equals(r.Value)) {
                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("modifier", context.JsonContext, _retVal, context));
                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                            _retVal.ModifierKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                    else {
                                                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.InvoiceElement))) {
                                                                                                                                                                                                                SanteDB.Core.Model.Acts.InvoiceElement _nretVal = ((SanteDB.Core.Model.Acts.InvoiceElement)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                                return _nretVal;
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                        else {
                                                                                                                                                                                                            r.Skip();
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ObservationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ObservationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.Observation);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.Observation _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.Observation)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.Observation)));
            }
            if (context.ShouldSerialize("interpretationConcept")) {
                if ((_strong.InterpretationConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConcept", _strong.InterpretationConceptKey, context);
                }
            }
            if (context.ShouldSerialize("valueType")) {
                if ((_strong.ValueType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueType", _strong.ValueType, context);
                }
            }
            if (context.ShouldSerialize("interpretationConceptModel")) {
                if ((_strong.InterpretationConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("interpretationConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.InterpretationConceptKey);
                        if ((_delay != null)) {
                            _strong.InterpretationConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("interpretationConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.Observation _retVal = new SanteDB.Core.Model.Acts.Observation();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("interpretationConceptModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.InterpretationConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("valueType".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueType", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.ValueType = ((string)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("interpretationConcept".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.InterpretationConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("$type".Equals(r.Value)) {
                                                                                                                                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                        if ((_type != typeof(SanteDB.Core.Model.Acts.Observation))) {
                                                                                                                                                                                            SanteDB.Core.Model.Acts.Observation _nretVal = ((SanteDB.Core.Model.Acts.Observation)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                            _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                            return _nretVal;
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        r.Skip();
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class QuantityObservationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(QuantityObservationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.QuantityObservation);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.QuantityObservation _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.QuantityObservation)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.QuantityObservation)));
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("valueType")) {
                if ((_strong.ValueType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueType", _strong.ValueType, context);
                }
            }
            if (context.ShouldSerialize("unitOfMeasure")) {
                if ((_strong.UnitOfMeasureKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "unitOfMeasure", _strong.UnitOfMeasureKey, context);
                }
            }
            if (context.ShouldSerialize("unitOfMeasureModel")) {
                if ((_strong.UnitOfMeasure == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("unitOfMeasureModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.UnitOfMeasureKey);
                        if ((_delay != null)) {
                            _strong.UnitOfMeasure = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "unitOfMeasureModel", _strong.UnitOfMeasure, context);
                        }
                        else {
                            context.RegisterMissTarget("unitOfMeasureModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "unitOfMeasureModel", _strong.UnitOfMeasure, context);
                }
            }
            if (context.ShouldSerialize("interpretationConcept")) {
                if ((_strong.InterpretationConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConcept", _strong.InterpretationConceptKey, context);
                }
            }
            if (context.ShouldSerialize("interpretationConceptModel")) {
                if ((_strong.InterpretationConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("interpretationConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.InterpretationConceptKey);
                        if ((_delay != null)) {
                            _strong.InterpretationConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("interpretationConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.QuantityObservation _retVal = new SanteDB.Core.Model.Acts.QuantityObservation();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("interpretationConceptModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.InterpretationConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("interpretationConcept".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.InterpretationConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("unitOfMeasureModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("unitOfMeasureModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.UnitOfMeasure = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("unitOfMeasure".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("unitOfMeasure", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.UnitOfMeasureKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("valueType".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueType", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.ValueType = ((string)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("value".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.Value = ((decimal)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.QuantityObservation))) {
                                                                                                                                                                                                        SanteDB.Core.Model.Acts.QuantityObservation _nretVal = ((SanteDB.Core.Model.Acts.QuantityObservation)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class TextObservationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(TextObservationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.TextObservation);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.TextObservation _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.TextObservation)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.TextObservation)));
            }
            if (context.ShouldSerialize("valueType")) {
                if ((_strong.ValueType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueType", _strong.ValueType, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.Value == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("interpretationConcept")) {
                if ((_strong.InterpretationConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConcept", _strong.InterpretationConceptKey, context);
                }
            }
            if (context.ShouldSerialize("interpretationConceptModel")) {
                if ((_strong.InterpretationConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("interpretationConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.InterpretationConceptKey);
                        if ((_delay != null)) {
                            _strong.InterpretationConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("interpretationConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.TextObservation _retVal = new SanteDB.Core.Model.Acts.TextObservation();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("interpretationConceptModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.InterpretationConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("interpretationConcept".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.InterpretationConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("value".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.Value = ((string)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("valueType".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueType", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.ValueType = ((string)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.TextObservation))) {
                                                                                                                                                                                                SanteDB.Core.Model.Acts.TextObservation _nretVal = ((SanteDB.Core.Model.Acts.TextObservation)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                return _nretVal;
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            r.Skip();
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class CodedObservationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(CodedObservationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.CodedObservation);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.CodedObservation _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.CodedObservation)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.CodedObservation)));
            }
            if (context.ShouldSerialize("valueType")) {
                if ((_strong.ValueType == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueType", _strong.ValueType, context);
                }
            }
            if (context.ShouldSerialize("value")) {
                if ((_strong.ValueKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "value", _strong.ValueKey, context);
                }
            }
            if (context.ShouldSerialize("valueModel")) {
                if ((_strong.Value == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("valueModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ValueKey);
                        if ((_delay != null)) {
                            _strong.Value = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "valueModel", _strong.Value, context);
                        }
                        else {
                            context.RegisterMissTarget("valueModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "valueModel", _strong.Value, context);
                }
            }
            if (context.ShouldSerialize("interpretationConcept")) {
                if ((_strong.InterpretationConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConcept", _strong.InterpretationConceptKey, context);
                }
            }
            if (context.ShouldSerialize("interpretationConceptModel")) {
                if ((_strong.InterpretationConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("interpretationConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.InterpretationConceptKey);
                        if ((_delay != null)) {
                            _strong.InterpretationConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("interpretationConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "interpretationConceptModel", _strong.InterpretationConcept, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.CodedObservation _retVal = new SanteDB.Core.Model.Acts.CodedObservation();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("interpretationConceptModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConceptModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.InterpretationConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("interpretationConcept".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("interpretationConcept", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.InterpretationConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("valueModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.Value = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("value".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("value", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.ValueKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("valueType".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("valueType", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.ValueType = ((string)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                if ((_type != typeof(SanteDB.Core.Model.Acts.CodedObservation))) {
                                                                                                                                                                                                    SanteDB.Core.Model.Acts.CodedObservation _nretVal = ((SanteDB.Core.Model.Acts.CodedObservation)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                    _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                    return _nretVal;
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                r.Skip();
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class PatientEncounterViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(PatientEncounterViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.PatientEncounter);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.PatientEncounter _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.PatientEncounter)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.PatientEncounter)));
            }
            if (context.ShouldSerialize("dischargeDisposition")) {
                if ((_strong.DischargeDispositionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dischargeDisposition", _strong.DischargeDispositionKey, context);
                }
            }
            if (context.ShouldSerialize("dischargeDispositionModel")) {
                if ((_strong.DischargeDisposition == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("dischargeDispositionModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DischargeDispositionKey);
                        if ((_delay != null)) {
                            _strong.DischargeDisposition = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "dischargeDispositionModel", _strong.DischargeDisposition, context);
                        }
                        else {
                            context.RegisterMissTarget("dischargeDispositionModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "dischargeDispositionModel", _strong.DischargeDisposition, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.PatientEncounter _retVal = new SanteDB.Core.Model.Acts.PatientEncounter();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("dischargeDispositionModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dischargeDispositionModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.DischargeDisposition = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("dischargeDisposition".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("dischargeDisposition", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.DischargeDispositionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.PatientEncounter))) {
                                                                                                                                                                                        SanteDB.Core.Model.Acts.PatientEncounter _nretVal = ((SanteDB.Core.Model.Acts.PatientEncounter)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ProcedureViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ProcedureViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.Procedure);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.Procedure _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.Procedure)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.Procedure)));
            }
            if (context.ShouldSerialize("method")) {
                if ((_strong.MethodKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "method", _strong.MethodKey, context);
                }
            }
            if (context.ShouldSerialize("approachSite")) {
                if ((_strong.ApproachSiteKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "approachSite", _strong.ApproachSiteKey, context);
                }
            }
            if (context.ShouldSerialize("targetSite")) {
                if ((_strong.TargetSiteKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetSite", _strong.TargetSiteKey, context);
                }
            }
            if (context.ShouldSerialize("methodModel")) {
                if ((_strong.Method == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("methodModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MethodKey);
                        if ((_delay != null)) {
                            _strong.Method = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "methodModel", _strong.Method, context);
                        }
                        else {
                            context.RegisterMissTarget("methodModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "methodModel", _strong.Method, context);
                }
            }
            if (context.ShouldSerialize("approachSiteModel")) {
                if ((_strong.ApproachSite == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("approachSiteModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ApproachSiteKey);
                        if ((_delay != null)) {
                            _strong.ApproachSite = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "approachSiteModel", _strong.ApproachSite, context);
                        }
                        else {
                            context.RegisterMissTarget("approachSiteModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "approachSiteModel", _strong.ApproachSite, context);
                }
            }
            if (context.ShouldSerialize("targetSiteModel")) {
                if ((_strong.TargetSite == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("targetSiteModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TargetSiteKey);
                        if ((_delay != null)) {
                            _strong.TargetSite = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "targetSiteModel", _strong.TargetSite, context);
                        }
                        else {
                            context.RegisterMissTarget("targetSiteModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "targetSiteModel", _strong.TargetSite, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.Procedure _retVal = new SanteDB.Core.Model.Acts.Procedure();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("targetSiteModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetSiteModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.TargetSite = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("approachSiteModel".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("approachSiteModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.ApproachSite = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("methodModel".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("methodModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.Method = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("targetSite".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("targetSite", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.TargetSiteKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("approachSite".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("approachSite", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.ApproachSiteKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("method".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("method", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.MethodKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                    System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                    if ((_type != typeof(SanteDB.Core.Model.Acts.Procedure))) {
                                                                                                                                                                                                        SanteDB.Core.Model.Acts.Procedure _nretVal = ((SanteDB.Core.Model.Acts.Procedure)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                        _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                        return _nretVal;
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    r.Skip();
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class ProtocolViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(ProtocolViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.Protocol);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.Protocol _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.Protocol)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.Protocol)));
            }
            if (context.ShouldSerialize("name")) {
                if ((_strong.Name == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "name", _strong.Name, context);
                }
            }
            if (context.ShouldSerialize("handlerClass")) {
                if ((_strong.HandlerClassName == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "handlerClass", _strong.HandlerClassName, context);
                }
            }
            if (context.ShouldSerialize("oid")) {
                if ((_strong.Oid == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "oid", _strong.Oid, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if ((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue))) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.Protocol _retVal = new SanteDB.Core.Model.Acts.Protocol();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("oid".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("oid", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.Oid = ((string)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("handlerClass".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("handlerClass", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.HandlerClassName = ((string)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("name".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("name", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.Name = ((string)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("$type".Equals(r.Value)) {
                                                                        System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                        if ((_type != typeof(SanteDB.Core.Model.Acts.Protocol))) {
                                                                            SanteDB.Core.Model.Acts.Protocol _nretVal = ((SanteDB.Core.Model.Acts.Protocol)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                            _nretVal.CopyObjectData(_retVal);
                                                                            return _nretVal;
                                                                        }
                                                                    }
                                                                    else {
                                                                        r.Skip();
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
    
    public class SubstanceAdministrationViewModelSerializer : SanteDB.Core.Applets.ViewModel.Json.IJsonViewModelTypeFormatter {
        
        private SanteDB.Core.Model.Serialization.ModelSerializationBinder m_binder = new SanteDB.Core.Model.Serialization.ModelSerializationBinder();
        
        private SanteDB.Core.Diagnostics.Tracer m_tracer = SanteDB.Core.Diagnostics.Tracer.GetTracer(typeof(SubstanceAdministrationViewModelSerializer));
        
        public System.Type HandlesType {
            get {
                return typeof(SanteDB.Core.Model.Acts.SubstanceAdministration);
            }
        }
        
        public void Serialize(Newtonsoft.Json.JsonWriter w, SanteDB.Core.Model.IdentifiedData o, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            if ((o == null)) {
                throw new System.ArgumentNullException("o");
            }
            SanteDB.Core.Model.Acts.SubstanceAdministration _strong = null;
            SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext _jsonContext = null;
            bool _loaded = false;
            try {
                _strong = ((SanteDB.Core.Model.Acts.SubstanceAdministration)(o));
            }
            catch (System.Exception e) {
                this.m_tracer.TraceError(string.Format("Casting Error: {0}", e));
                throw new System.ArgumentException(string.Format("Invalid type {0} provided, expected {1}", o.GetType(), typeof(SanteDB.Core.Model.Acts.SubstanceAdministration)));
            }
            if (context.ShouldSerialize("route")) {
                if ((_strong.RouteKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "route", _strong.RouteKey, context);
                }
            }
            if (context.ShouldSerialize("doseUnit")) {
                if ((_strong.DoseUnitKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "doseUnit", _strong.DoseUnitKey, context);
                }
            }
            if (context.ShouldSerialize("routeModel")) {
                if ((_strong.Route == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("routeModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.RouteKey);
                        if ((_delay != null)) {
                            _strong.Route = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "routeModel", _strong.Route, context);
                        }
                        else {
                            context.RegisterMissTarget("routeModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "routeModel", _strong.Route, context);
                }
            }
            if (context.ShouldSerialize("doseUnitModel")) {
                if ((_strong.DoseUnit == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("doseUnitModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.DoseUnitKey);
                        if ((_delay != null)) {
                            _strong.DoseUnit = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "doseUnitModel", _strong.DoseUnit, context);
                        }
                        else {
                            context.RegisterMissTarget("doseUnitModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "doseUnitModel", _strong.DoseUnit, context);
                }
            }
            if (context.ShouldSerialize("doseQuantity")) {
                if ((_strong.DoseQuantity == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "doseQuantity", _strong.DoseQuantity, context);
                }
            }
            if (context.ShouldSerialize("doseSequence")) {
                if ((_strong.SequenceId == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "doseSequence", _strong.SequenceId, context);
                }
            }
            if (context.ShouldSerialize("site")) {
                if ((_strong.SiteKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "site", _strong.SiteKey, context);
                }
            }
            if (context.ShouldSerialize("siteModel")) {
                if ((_strong.Site == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("siteModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.SiteKey);
                        if ((_delay != null)) {
                            _strong.Site = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "siteModel", _strong.Site, context);
                        }
                        else {
                            context.RegisterMissTarget("siteModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "siteModel", _strong.Site, context);
                }
            }
            if (context.ShouldSerialize("isNegated")) {
                if ((_strong.IsNegated == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "isNegated", _strong.IsNegated, context);
                }
            }
            if (context.ShouldSerialize("template")) {
                if ((_strong.TemplateKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "template", _strong.TemplateKey, context);
                }
            }
            if (context.ShouldSerialize("templateModel")) {
                if ((_strong.Template == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("templateModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.TemplateDefinition _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.TemplateDefinition>(_strong.TemplateKey);
                        if ((_delay != null)) {
                            _strong.Template = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                        }
                        else {
                            context.RegisterMissTarget("templateModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "templateModel", _strong.Template, context);
                }
            }
            if (context.ShouldSerialize("actTime")) {
                if ((_strong.ActTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "actTime", _strong.ActTimeXml, context);
                }
            }
            if (context.ShouldSerialize("startTime")) {
                if ((_strong.StartTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "startTime", _strong.StartTimeXml, context);
                }
            }
            if (context.ShouldSerialize("stopTime")) {
                if ((_strong.StopTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "stopTime", _strong.StopTimeXml, context);
                }
            }
            if (context.ShouldSerialize("classConcept")) {
                if ((_strong.ClassConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConcept", _strong.ClassConceptKey, context);
                }
            }
            if (context.ShouldSerialize("moodConcept")) {
                if ((_strong.MoodConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConcept", _strong.MoodConceptKey, context);
                }
            }
            if (context.ShouldSerialize("reasonConcept")) {
                if ((_strong.ReasonConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConcept", _strong.ReasonConceptKey, context);
                }
            }
            if (context.ShouldSerialize("statusConcept")) {
                if ((_strong.StatusConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConcept", _strong.StatusConceptKey, context);
                }
            }
            if (context.ShouldSerialize("typeConcept")) {
                if ((_strong.TypeConceptKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConcept", _strong.TypeConceptKey, context);
                }
            }
            if (context.ShouldSerialize("classConceptModel")) {
                if ((_strong.ClassConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("classConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ClassConceptKey);
                        if ((_delay != null)) {
                            _strong.ClassConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("classConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "classConceptModel", _strong.ClassConcept, context);
                }
            }
            if (context.ShouldSerialize("moodConceptModel")) {
                if ((_strong.MoodConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("moodConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.MoodConceptKey);
                        if ((_delay != null)) {
                            _strong.MoodConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("moodConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "moodConceptModel", _strong.MoodConcept, context);
                }
            }
            if (context.ShouldSerialize("reasonConceptModel")) {
                if ((_strong.ReasonConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("reasonConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.ReasonConceptKey);
                        if ((_delay != null)) {
                            _strong.ReasonConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("reasonConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "reasonConceptModel", _strong.ReasonConcept, context);
                }
            }
            if (context.ShouldSerialize("statusConceptModel")) {
                if ((_strong.StatusConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("statusConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.StatusConceptKey);
                        if ((_delay != null)) {
                            _strong.StatusConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("statusConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "statusConceptModel", _strong.StatusConcept, context);
                }
            }
            if (context.ShouldSerialize("typeConceptModel")) {
                if ((_strong.TypeConcept == null)) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("typeConceptModel", _strong.Key.Value))) {
                        SanteDB.Core.Model.DataTypes.Concept _delay = null;
                        _delay = context.JsonContext.LoadRelated<SanteDB.Core.Model.DataTypes.Concept>(_strong.TypeConceptKey);
                        if ((_delay != null)) {
                            _strong.TypeConcept = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                        }
                        else {
                            context.RegisterMissTarget("typeConceptModel", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "typeConceptModel", _strong.TypeConcept, context);
                }
            }
            if (context.ShouldSerialize("identifier")) {
                if (((_strong.Identifiers == null) 
                            || (_strong.Identifiers.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("identifier", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActIdentifier>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Identifiers = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                        }
                        else {
                            context.RegisterMissTarget("identifier", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "identifier", _strong.Identifiers, context);
                }
            }
            if (context.ShouldSerialize("relationship")) {
                if (((_strong.Relationships == null) 
                            || (_strong.Relationships.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("relationship", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActRelationship>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Relationships = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                        }
                        else {
                            context.RegisterMissTarget("relationship", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "relationship", _strong.Relationships, context);
                }
            }
            if (context.ShouldSerialize("policy")) {
                if (((_strong.Policies == null) 
                            || (_strong.Policies.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("policy", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Security.SecurityPolicyInstance>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Policies = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                        }
                        else {
                            context.RegisterMissTarget("policy", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "policy", _strong.Policies, context);
                }
            }
            if (context.ShouldSerialize("extension")) {
                if (((_strong.Extensions == null) 
                            || (_strong.Extensions.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("extension", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActExtension>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Extensions = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                        }
                        else {
                            context.RegisterMissTarget("extension", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "extension", _strong.Extensions, context);
                }
            }
            if (context.ShouldSerialize("note")) {
                if (((_strong.Notes == null) 
                            || (_strong.Notes.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("note", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActNote>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Notes = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                        }
                        else {
                            context.RegisterMissTarget("note", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "note", _strong.Notes, context);
                }
            }
            if (context.ShouldSerialize("tag")) {
                if (((_strong.Tags == null) 
                            || (_strong.Tags.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("tag", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>(context.JsonContext.LoadCollection<SanteDB.Core.Model.DataTypes.ActTag>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Tags = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                        }
                        else {
                            context.RegisterMissTarget("tag", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "tag", _strong.Tags, context);
                }
            }
            if (context.ShouldSerialize("protocol")) {
                if (((_strong.Protocols == null) 
                            || (_strong.Protocols.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("protocol", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActProtocol>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Protocols = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                        }
                        else {
                            context.RegisterMissTarget("protocol", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "protocol", _strong.Protocols, context);
                }
            }
            if (context.ShouldSerialize("participation")) {
                if (((_strong.Participations == null) 
                            || (_strong.Participations.Count == 0))) {
                    if ((_strong.Key.HasValue && context.ShouldForceLoad("participation", _strong.Key.Value))) {
                        System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation> _delay = null;
                        _delay = new System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>(context.JsonContext.LoadCollection<SanteDB.Core.Model.Acts.ActParticipation>(_strong.Key.Value));
                        if ((_delay.Count > 0)) {
                            _strong.Participations = _delay;
                            _loaded = true;
                            context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                        }
                        else {
                            context.RegisterMissTarget("participation", _strong.Key.Value);
                        }
                    }
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "participation", _strong.Participations, context);
                }
            }
            if (context.ShouldSerialize("geo")) {
                if ((_strong.GeoTag == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "geo", _strong.GeoTag, context);
                }
            }
            if (context.ShouldSerialize("previousVersion")) {
                if ((_strong.PreviousVersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "previousVersion", _strong.PreviousVersionKey, context);
                }
            }
            if (context.ShouldSerialize("version")) {
                if ((_strong.VersionKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "version", _strong.VersionKey, context);
                }
            }
            if (context.ShouldSerialize("sequence")) {
                if ((_strong.VersionSequence == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "sequence", _strong.VersionSequence, context);
                }
            }
            if (context.ShouldSerialize("creationTimeModel")) {
                if ((_strong.CreationTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTimeModel", _strong.CreationTime, context);
                }
            }
            if (context.ShouldSerialize("creationTime")) {
                if ((_strong.CreationTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "creationTime", _strong.CreationTimeXml, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTimeModel")) {
                if ((_strong.ObsoletionTime == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTimeModel", _strong.ObsoletionTime, context);
                }
            }
            if (context.ShouldSerialize("obsoletionTime")) {
                if ((_strong.ObsoletionTimeXml == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletionTime", _strong.ObsoletionTimeXml, context);
                }
            }
            if (context.ShouldSerialize("createdBy")) {
                if ((_strong.CreatedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "createdBy", _strong.CreatedByKey, context);
                }
            }
            if (context.ShouldSerialize("obsoletedBy")) {
                if ((_strong.ObsoletedByKey == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "obsoletedBy", _strong.ObsoletedByKey, context);
                }
            }
            if (context.ShouldSerialize("id")) {
                if ((_strong.Key == null)) {
                }
                else {
                    context.JsonContext.WritePropertyUtil(w, "id", _strong.Key, context);
                }
            }
            if (((_loaded 
                        && ((SanteDB.Core.Model.LoadState.New != _strong.LoadState) 
                        && _strong.Key.HasValue)) 
                        && _strong.VersionKey.HasValue)) {
                ((SanteDB.Core.Services.IDataCachingService)(SanteDB.Core.ApplicationServiceContext.Current.GetService(typeof(SanteDB.Core.Services.IDataCachingService)))).Add(_strong);
            }
        }
        
        public object Deserialize(Newtonsoft.Json.JsonReader r, System.Type asType, SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext context) {
            SanteDB.Core.Model.Acts.SubstanceAdministration _retVal = new SanteDB.Core.Model.Acts.SubstanceAdministration();
            int _depth = r.Depth;
            if ((r.TokenType != Newtonsoft.Json.JsonToken.StartObject)) {
                _depth = (_depth - 1);
            }
            for (
            ; r.Read(); 
            ) {
                if ((r.TokenType == Newtonsoft.Json.JsonToken.PropertyName)) {
                    if ("id".Equals(r.Value)) {
                        r.Read();
                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("id", context.JsonContext, _retVal, context));
                        if ((_instance != null)) {
                            _retVal.Key = ((System.Nullable<System.Guid>)(_instance));
                        }
                    }
                    else {
                        if ("obsoletedBy".Equals(r.Value)) {
                            r.Read();
                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedBy", context.JsonContext, _retVal, context));
                            if ((_instance != null)) {
                                _retVal.ObsoletedByKey = ((System.Nullable<System.Guid>)(_instance));
                            }
                        }
                        else {
                            if ("createdBy".Equals(r.Value)) {
                                r.Read();
                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdBy", context.JsonContext, _retVal, context));
                                if ((_instance != null)) {
                                    _retVal.CreatedByKey = ((System.Nullable<System.Guid>)(_instance));
                                }
                            }
                            else {
                                if ("obsoletedByModel".Equals(r.Value)) {
                                    r.Read();
                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletedByModel", context.JsonContext, _retVal, context));
                                    if ((_instance != null)) {
                                        _retVal.ObsoletedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                    }
                                }
                                else {
                                    if ("createdByModel".Equals(r.Value)) {
                                        r.Read();
                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.Security.SecurityProvenance), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("createdByModel", context.JsonContext, _retVal, context));
                                        if ((_instance != null)) {
                                            _retVal.CreatedBy = ((SanteDB.Core.Model.Security.SecurityProvenance)(_instance));
                                        }
                                    }
                                    else {
                                        if ("obsoletionTime".Equals(r.Value)) {
                                            r.Read();
                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTime", context.JsonContext, _retVal, context));
                                            if ((_instance != null)) {
                                                _retVal.ObsoletionTimeXml = ((string)(_instance));
                                            }
                                        }
                                        else {
                                            if ("obsoletionTimeModel".Equals(r.Value)) {
                                                r.Read();
                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.DateTimeOffset>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("obsoletionTimeModel", context.JsonContext, _retVal, context));
                                                if ((_instance != null)) {
                                                    _retVal.ObsoletionTime = ((System.Nullable<System.DateTimeOffset>)(_instance));
                                                }
                                            }
                                            else {
                                                if ("creationTime".Equals(r.Value)) {
                                                    r.Read();
                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTime", context.JsonContext, _retVal, context));
                                                    if ((_instance != null)) {
                                                        _retVal.CreationTimeXml = ((string)(_instance));
                                                    }
                                                }
                                                else {
                                                    if ("creationTimeModel".Equals(r.Value)) {
                                                        r.Read();
                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.DateTimeOffset), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("creationTimeModel", context.JsonContext, _retVal, context));
                                                        if ((_instance != null)) {
                                                            _retVal.CreationTime = ((System.DateTimeOffset)(_instance));
                                                        }
                                                    }
                                                    else {
                                                        if ("sequence".Equals(r.Value)) {
                                                            r.Read();
                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<int>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("sequence", context.JsonContext, _retVal, context));
                                                            if ((_instance != null)) {
                                                                _retVal.VersionSequence = ((System.Nullable<int>)(_instance));
                                                            }
                                                        }
                                                        else {
                                                            if ("version".Equals(r.Value)) {
                                                                r.Read();
                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("version", context.JsonContext, _retVal, context));
                                                                if ((_instance != null)) {
                                                                    _retVal.VersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                }
                                                            }
                                                            else {
                                                                if ("previousVersion".Equals(r.Value)) {
                                                                    r.Read();
                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("previousVersion", context.JsonContext, _retVal, context));
                                                                    if ((_instance != null)) {
                                                                        _retVal.PreviousVersionKey = ((System.Nullable<System.Guid>)(_instance));
                                                                    }
                                                                }
                                                                else {
                                                                    if ("geo".Equals(r.Value)) {
                                                                        r.Read();
                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.GeoTag), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("geo", context.JsonContext, _retVal, context));
                                                                        if ((_instance != null)) {
                                                                            _retVal.GeoTag = ((SanteDB.Core.Model.DataTypes.GeoTag)(_instance));
                                                                        }
                                                                    }
                                                                    else {
                                                                        if ("participation".Equals(r.Value)) {
                                                                            r.Read();
                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("participation", context.JsonContext, _retVal, context));
                                                                            if ((_instance != null)) {
                                                                                _retVal.Participations = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActParticipation>)(_instance));
                                                                            }
                                                                        }
                                                                        else {
                                                                            if ("protocol".Equals(r.Value)) {
                                                                                r.Read();
                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("protocol", context.JsonContext, _retVal, context));
                                                                                if ((_instance != null)) {
                                                                                    _retVal.Protocols = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActProtocol>)(_instance));
                                                                                }
                                                                            }
                                                                            else {
                                                                                if ("tag".Equals(r.Value)) {
                                                                                    r.Read();
                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("tag", context.JsonContext, _retVal, context));
                                                                                    if ((_instance != null)) {
                                                                                        _retVal.Tags = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActTag>)(_instance));
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if ("note".Equals(r.Value)) {
                                                                                        r.Read();
                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("note", context.JsonContext, _retVal, context));
                                                                                        if ((_instance != null)) {
                                                                                            _retVal.Notes = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActNote>)(_instance));
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if ("extension".Equals(r.Value)) {
                                                                                            r.Read();
                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("extension", context.JsonContext, _retVal, context));
                                                                                            if ((_instance != null)) {
                                                                                                _retVal.Extensions = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActExtension>)(_instance));
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if ("policy".Equals(r.Value)) {
                                                                                                r.Read();
                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("policy", context.JsonContext, _retVal, context));
                                                                                                if ((_instance != null)) {
                                                                                                    _retVal.Policies = ((System.Collections.Generic.List<SanteDB.Core.Model.Security.SecurityPolicyInstance>)(_instance));
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if ("relationship".Equals(r.Value)) {
                                                                                                    r.Read();
                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("relationship", context.JsonContext, _retVal, context));
                                                                                                    if ((_instance != null)) {
                                                                                                        _retVal.Relationships = ((System.Collections.Generic.List<SanteDB.Core.Model.Acts.ActRelationship>)(_instance));
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if ("identifier".Equals(r.Value)) {
                                                                                                        r.Read();
                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("identifier", context.JsonContext, _retVal, context));
                                                                                                        if ((_instance != null)) {
                                                                                                            _retVal.Identifiers = ((System.Collections.Generic.List<SanteDB.Core.Model.DataTypes.ActIdentifier>)(_instance));
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if ("typeConceptModel".Equals(r.Value)) {
                                                                                                            r.Read();
                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConceptModel", context.JsonContext, _retVal, context));
                                                                                                            if ((_instance != null)) {
                                                                                                                _retVal.TypeConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if ("statusConceptModel".Equals(r.Value)) {
                                                                                                                r.Read();
                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConceptModel", context.JsonContext, _retVal, context));
                                                                                                                if ((_instance != null)) {
                                                                                                                    _retVal.StatusConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if ("reasonConceptModel".Equals(r.Value)) {
                                                                                                                    r.Read();
                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConceptModel", context.JsonContext, _retVal, context));
                                                                                                                    if ((_instance != null)) {
                                                                                                                        _retVal.ReasonConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    if ("moodConceptModel".Equals(r.Value)) {
                                                                                                                        r.Read();
                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConceptModel", context.JsonContext, _retVal, context));
                                                                                                                        if ((_instance != null)) {
                                                                                                                            _retVal.MoodConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if ("classConceptModel".Equals(r.Value)) {
                                                                                                                            r.Read();
                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConceptModel", context.JsonContext, _retVal, context));
                                                                                                                            if ((_instance != null)) {
                                                                                                                                _retVal.ClassConcept = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                            }
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            if ("typeConcept".Equals(r.Value)) {
                                                                                                                                r.Read();
                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("typeConcept", context.JsonContext, _retVal, context));
                                                                                                                                if ((_instance != null)) {
                                                                                                                                    _retVal.TypeConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                }
                                                                                                                            }
                                                                                                                            else {
                                                                                                                                if ("statusConcept".Equals(r.Value)) {
                                                                                                                                    r.Read();
                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("statusConcept", context.JsonContext, _retVal, context));
                                                                                                                                    if ((_instance != null)) {
                                                                                                                                        _retVal.StatusConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                else {
                                                                                                                                    if ("reasonConcept".Equals(r.Value)) {
                                                                                                                                        r.Read();
                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("reasonConcept", context.JsonContext, _retVal, context));
                                                                                                                                        if ((_instance != null)) {
                                                                                                                                            _retVal.ReasonConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    else {
                                                                                                                                        if ("moodConcept".Equals(r.Value)) {
                                                                                                                                            r.Read();
                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("moodConcept", context.JsonContext, _retVal, context));
                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                _retVal.MoodConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        else {
                                                                                                                                            if ("classConcept".Equals(r.Value)) {
                                                                                                                                                r.Read();
                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("classConcept", context.JsonContext, _retVal, context));
                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                    _retVal.ClassConceptKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                            else {
                                                                                                                                                if ("stopTime".Equals(r.Value)) {
                                                                                                                                                    r.Read();
                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("stopTime", context.JsonContext, _retVal, context));
                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                        _retVal.StopTimeXml = ((string)(_instance));
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                                else {
                                                                                                                                                    if ("startTime".Equals(r.Value)) {
                                                                                                                                                        r.Read();
                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("startTime", context.JsonContext, _retVal, context));
                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                            _retVal.StartTimeXml = ((string)(_instance));
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                    else {
                                                                                                                                                        if ("actTime".Equals(r.Value)) {
                                                                                                                                                            r.Read();
                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(string), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("actTime", context.JsonContext, _retVal, context));
                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                _retVal.ActTimeXml = ((string)(_instance));
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                        else {
                                                                                                                                                            if ("templateModel".Equals(r.Value)) {
                                                                                                                                                                r.Read();
                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.TemplateDefinition), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("templateModel", context.JsonContext, _retVal, context));
                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                    _retVal.Template = ((SanteDB.Core.Model.DataTypes.TemplateDefinition)(_instance));
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                            else {
                                                                                                                                                                if ("template".Equals(r.Value)) {
                                                                                                                                                                    r.Read();
                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("template", context.JsonContext, _retVal, context));
                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                        _retVal.TemplateKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                                else {
                                                                                                                                                                    if ("isNegated".Equals(r.Value)) {
                                                                                                                                                                        r.Read();
                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(bool), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("isNegated", context.JsonContext, _retVal, context));
                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                            _retVal.IsNegated = ((bool)(_instance));
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                    else {
                                                                                                                                                                        if ("siteModel".Equals(r.Value)) {
                                                                                                                                                                            r.Read();
                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("siteModel", context.JsonContext, _retVal, context));
                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                _retVal.Site = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                        else {
                                                                                                                                                                            if ("site".Equals(r.Value)) {
                                                                                                                                                                                r.Read();
                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("site", context.JsonContext, _retVal, context));
                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                    _retVal.SiteKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                            else {
                                                                                                                                                                                if ("doseSequence".Equals(r.Value)) {
                                                                                                                                                                                    r.Read();
                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(int), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("doseSequence", context.JsonContext, _retVal, context));
                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                        _retVal.SequenceId = ((int)(_instance));
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                                else {
                                                                                                                                                                                    if ("doseQuantity".Equals(r.Value)) {
                                                                                                                                                                                        r.Read();
                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(decimal), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("doseQuantity", context.JsonContext, _retVal, context));
                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                            _retVal.DoseQuantity = ((decimal)(_instance));
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                    else {
                                                                                                                                                                                        if ("doseUnitModel".Equals(r.Value)) {
                                                                                                                                                                                            r.Read();
                                                                                                                                                                                            object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("doseUnitModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                            if ((_instance != null)) {
                                                                                                                                                                                                _retVal.DoseUnit = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                        else {
                                                                                                                                                                                            if ("routeModel".Equals(r.Value)) {
                                                                                                                                                                                                r.Read();
                                                                                                                                                                                                object _instance = context.JsonContext.ReadElementUtil(r, typeof(SanteDB.Core.Model.DataTypes.Concept), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("routeModel", context.JsonContext, _retVal, context));
                                                                                                                                                                                                if ((_instance != null)) {
                                                                                                                                                                                                    _retVal.Route = ((SanteDB.Core.Model.DataTypes.Concept)(_instance));
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                            else {
                                                                                                                                                                                                if ("doseUnit".Equals(r.Value)) {
                                                                                                                                                                                                    r.Read();
                                                                                                                                                                                                    object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("doseUnit", context.JsonContext, _retVal, context));
                                                                                                                                                                                                    if ((_instance != null)) {
                                                                                                                                                                                                        _retVal.DoseUnitKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                else {
                                                                                                                                                                                                    if ("route".Equals(r.Value)) {
                                                                                                                                                                                                        r.Read();
                                                                                                                                                                                                        object _instance = context.JsonContext.ReadElementUtil(r, typeof(System.Nullable<System.Guid>), new SanteDB.Core.Applets.ViewModel.Json.JsonSerializationContext("route", context.JsonContext, _retVal, context));
                                                                                                                                                                                                        if ((_instance != null)) {
                                                                                                                                                                                                            _retVal.RouteKey = ((System.Nullable<System.Guid>)(_instance));
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                    else {
                                                                                                                                                                                                        if ("$type".Equals(r.Value)) {
                                                                                                                                                                                                            System.Type _type = this.m_binder.BindToType("SanteDB.Core.Model, Version=1.38.0.29306, Culture=neutral, PublicKeyToken=null", r.ReadAsString());
                                                                                                                                                                                                            if ((_type != typeof(SanteDB.Core.Model.Acts.SubstanceAdministration))) {
                                                                                                                                                                                                                SanteDB.Core.Model.Acts.SubstanceAdministration _nretVal = ((SanteDB.Core.Model.Acts.SubstanceAdministration)(context.JsonContext.GetFormatter(_type).Deserialize(r, _type, context)));
                                                                                                                                                                                                                _nretVal.CopyObjectData(_retVal);
                                                                                                                                                                                                                return _nretVal;
                                                                                                                                                                                                            }
                                                                                                                                                                                                        }
                                                                                                                                                                                                        else {
                                                                                                                                                                                                            r.Skip();
                                                                                                                                                                                                        }
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (((r.TokenType == Newtonsoft.Json.JsonToken.EndObject) 
                                && (r.Depth == _depth))) {
                        return _retVal;
                    }
                    else {
                        throw new Newtonsoft.Json.JsonSerializationException("JSON in invalid state");
                    }
                }
            }
            return _retVal;
        }
        
        public object FromSimpleValue(object o) {
            return null;
        }
        
        public object GetSimpleValue(object o) {
            return null;
        }
    }
}
